(()=>{"use strict";var t={870:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Drawing=void 0;const a=s(212),i=s(601),o=s(71),n=s(646),r=s(44),l=s(909),c=s(718);e.Drawing=class{constructor(){this.tool=i.NullTool.Instance,this.startDraw=t=>{r.Control.isControlElem(t.target)||(this.tool=o.ToolFactory.getTool(n.BoardStorage.get("tool"),this.canvas,c.Properties.local),this.tool.startDraw(l.Mouse.getPosition(t)),window.addEventListener("pointermove",this.draw,!1))},this.draw=t=>this.tool.addPoint(l.Mouse.getPosition(t)),this.endDraw=()=>{window.removeEventListener("pointermove",this.draw,!1),this.tool.endDraw(),this.tool=i.NullTool.Instance},this.canvas=new a.Canvas,r.Control.setupListeners(),this.appendListeners()}static setup(){this.instance||(this.instance=new this)}appendListeners(){window.addEventListener("pointerdown",this.startDraw,!1),window.addEventListener("pointerup",this.endDraw,!1)}}},212:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Canvas=void 0;const a=s(426);e.Canvas=class{constructor(){this._canvas=document.createElement("canvas"),this._canvas.width=window.screen.availWidth,this._canvas.height=window.screen.availHeight,this._ctx=this._canvas.getContext("2d"),this.setup(),document.body.appendChild(this._canvas)}setup(){this.ctx.lineJoin=a.Config.lineJoin,this.ctx.lineCap=a.Config.lineCap}setColor(t){this._ctx.strokeStyle=t,this._ctx.fillStyle=t}setLineWidth(t){this._ctx.lineWidth=t}clear(){this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height)}get canvas(){return this._canvas}get ctx(){return this._ctx}}},426:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Config=void 0,e.Config={lineJoin:"round",lineCap:"round",canDraw:!1}},466:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MainCanvas=void 0;const a=s(212),i=s(646);class o extends a.Canvas{constructor(){super(),this.drawWhiteBackground(),this.drawFromStorage(),this.sendToBack()}static create(){this.Instance}static get Instance(){return this._instance||(this._instance=new this)}drawWhiteBackground(){let t=this.ctx.fillStyle;this.ctx.fillStyle="white",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle=t}drawFromStorage(){let t=i.BoardStorage.get("img");if(!t)return;let e=new Image;e.src=t,e.addEventListener("load",(()=>this.ctx.drawImage(e,0,0)))}sendToBack(){this.canvas.style.zIndex="-1000"}drawImage(t){this.ctx.drawImage(t,0,0)}saveInStorage(){let t=this.getImgSrc();i.BoardStorage.set("img",t)}getImgSrc(){let t=this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height);return this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.putImageData(t,0,0),this.canvas.toDataURL("image/png")}}e.MainCanvas=o},663:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Brush=void 0;const a=s(397);class i extends a.Tool{prepare(){this.canvas.setColor(this.properties.color),this.canvas.setLineWidth(this.properties.lineWidth)}}e.Brush=i,i._toolName="brush"},327:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Eraser=void 0;const a=s(397);class i extends a.Tool{prepare(){this.canvas.setColor("#ffffff"),this.canvas.setLineWidth(this.properties.lineWidth)}}e.Eraser=i,i._toolName="eraser"},601:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.NullTool=void 0;const a=s(718),i=s(397);class o extends i.Tool{constructor(){super({},a.Properties.local)}static get Instance(){return this._instance||(this._instance=new this)}addPoint(){}startDraw(){}endDraw(){}prepare(){}}e.NullTool=o,o._toolName="none"},397:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Tool=void 0;const a=s(466);e.Tool=class{constructor(t,e){this.canvas=t,this.properties=e,this.points=[]}static get toolName(){return this._toolName}addPoint(t){this.points.push(t),this.draw()}startDraw(t){this.prepare(),this.addPoint(t)}draw(){if(this.points.length<3){let t=this.points[0];return this.canvas.ctx.beginPath(),this.canvas.ctx.arc(t.x,t.y,this.canvas.ctx.lineWidth/2,0,2*Math.PI,!0),this.canvas.ctx.fill(),void this.canvas.ctx.closePath()}this.canvas.ctx.clearRect(0,0,this.canvas.canvas.width,this.canvas.canvas.height),this.canvas.ctx.beginPath(),this.canvas.ctx.moveTo(this.points[0].x,this.points[0].y);for(let t=1;t<this.points.length-2;t++){let e=(this.points[t].x+this.points[t+1].x)/2,s=(this.points[t].y+this.points[t+1].y)/2;this.canvas.ctx.quadraticCurveTo(this.points[t].x,this.points[t].y,e,s)}let t=this.points.length-2;this.canvas.ctx.quadraticCurveTo(this.points[t].x,this.points[t].y,this.points[t+1].x,this.points[t+1].y),this.canvas.ctx.stroke()}endDraw(){a.MainCanvas.Instance.drawImage(this.canvas.canvas),a.MainCanvas.Instance.saveInStorage(),this.canvas.clear()}}},71:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ToolFactory=void 0;const a=s(663),i=s(327);e.ToolFactory=class{static getTool(t,e,s){switch(t){case a.Brush.toolName:return new a.Brush(e,s);case i.Eraser.toolName:return new i.Eraser(e,s);default:throw new Error("Invalid Tool name")}}}},646:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BoardStorage=void 0;const a=s(392);e.BoardStorage=class{static set(t,e){"object"!=typeof e&&sessionStorage.setItem(t,e),e=JSON.stringify(e),sessionStorage.setItem(t,e)}static get(t){let e=sessionStorage.getItem(t);return a.Valid.isJSON(e)?JSON.parse(e):e}}},44:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Control=void 0;const a=s(646);class i{static isControlElem(t){let e=!1;return Array.from(this.elements.tools.children).forEach((s=>{s.className!=t.className||(e=!0)})),e||t.className==this.elements.colorOutput.className||t.className==this.elements.colorInput.className||t.className==this.elements.lineWidthInput.className||t.className==this.elements.lineWidthOutput.className||t.className==this.elements.download.className}static setupListeners(){this.elements.lineWidthInput.addEventListener("input",(t=>this.setLineWidth(+t.target.value))),this.elements.colorInput.addEventListener("input",(t=>this.setColor(t.target.value))),this.elements.tools.addEventListener("click",(t=>this.setTool(t.target.className))),this.elements.download.addEventListener("click",(()=>this.downloadImage()))}static setupInitialProperties(){this.setColor(a.BoardStorage.get("color")||"#000000"),this.setLineWidth(a.BoardStorage.get("lineWidth")||10),this.setTool(a.BoardStorage.get("tool")||"brush")}static setColor(t){a.BoardStorage.set("color",t),this.elements.colorOutput.style.backgroundColor=t}static setLineWidth(t){a.BoardStorage.set("lineWidth",t.toString()),this.elements.lineWidthOutput.value=t.toString(),this.elements.lineWidthInput.value=t.toString()}static setTool(t){"tools"!=t&&a.BoardStorage.set("tool",t)}static downloadImage(){let t=a.BoardStorage.get("img");this.elements.download.href=t}}e.Control=i,i.elements={colorOutput:document.getElementsByClassName("color-label-element")[0],colorInput:document.getElementsByClassName("color")[0],lineWidthOutput:document.getElementsByClassName("paint-size-out")[0],lineWidthInput:document.getElementsByClassName("paint-size-in")[0],tools:document.getElementsByClassName("tools")[0],download:document.getElementsByClassName("download")[0]}},909:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Mouse=void 0;const a=s(967);e.Mouse=class{static getPosition(t){return new a.Point(t.pageX,t.pageY)}}},967:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Point=void 0,e.Point=class{constructor(t,e){this._x=t,this._y=e}get x(){return this._x}get y(){return this._y}}},718:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Properties=void 0;const a=s(646);e.Properties=class{constructor(t,e){this._lineWidth=t,this._color=e}static get local(){return new this(+a.BoardStorage.get("lineWidth"),a.BoardStorage.get("color"))}get lineWidth(){return this._lineWidth}get color(){return this._color}}},392:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Valid=void 0,e.Valid=class{static isJSON(t){try{JSON.parse(t)}catch(t){return!1}return!0}}}},e={};function s(a){var i=e[a];if(void 0!==i)return i.exports;var o=e[a]={exports:{}};return t[a](o,o.exports,s),o.exports}(()=>{const t=s(870),e=s(466),a=s(44);(class{static run(){a.Control.setupInitialProperties(),e.MainCanvas.create(),t.Drawing.setup()}}).run()})()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Ly93aGl0ZWJvYXJkLXY1Ly4vYm9hcmQvdHMvY2FudmFzL0NhbnZhcy50cyIsIndlYnBhY2s6Ly93aGl0ZWJvYXJkLXY1Ly4vYm9hcmQvdHMvY2FudmFzL0NvbmZpZy50cyIsIndlYnBhY2s6Ly93aGl0ZWJvYXJkLXY1Ly4vYm9hcmQvdHMvY2FudmFzL01haW5DYW52YXMudHMiLCJ3ZWJwYWNrOi8vd2hpdGVib2FyZC12NS8uL2JvYXJkL3RzL3Rvb2xzL0JydXNoLnRzIiwid2VicGFjazovL3doaXRlYm9hcmQtdjUvLi9ib2FyZC90cy90b29scy9FcmFzZXIudHMiLCJ3ZWJwYWNrOi8vd2hpdGVib2FyZC12NS8uL2JvYXJkL3RzL3Rvb2xzL051bGxUb29sLnRzIiwid2VicGFjazovL3doaXRlYm9hcmQtdjUvLi9ib2FyZC90cy90b29scy9Ub29sLnRzIiwid2VicGFjazovL3doaXRlYm9hcmQtdjUvLi9ib2FyZC90cy90b29scy9Ub29sRmFjdG9yeS50cyIsIndlYnBhY2s6Ly93aGl0ZWJvYXJkLXY1Ly4vYm9hcmQvdHMvdXRpbC9Cb2FyZFN0b3JhZ2UudHMiLCJ3ZWJwYWNrOi8vd2hpdGVib2FyZC12NS8uL2JvYXJkL3RzL3V0aWwvQ29udHJvbC50cyIsIndlYnBhY2s6Ly93aGl0ZWJvYXJkLXY1Ly4vYm9hcmQvdHMvdXRpbC9Nb3VzZS50cyIsIndlYnBhY2s6Ly93aGl0ZWJvYXJkLXY1Ly4vYm9hcmQvdHMvdXRpbC9Qb2ludC50cyIsIndlYnBhY2s6Ly93aGl0ZWJvYXJkLXY1Ly4vYm9hcmQvdHMvdXRpbC9Qcm9wZXJ0aWVzLnRzIiwid2VicGFjazovL3doaXRlYm9hcmQtdjUvLi9ib2FyZC90cy91dGlsL1ZhbGlkLnRzIiwid2VicGFjazovL3doaXRlYm9hcmQtdjUvd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vd2hpdGVib2FyZC12NS8uL2JvYXJkL3RzL01haW4udHMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuZXhwb3J0cy5EcmF3aW5nID0gdm9pZCAwO1xyXG5jb25zdCBDYW52YXNfMSA9IHJlcXVpcmUoXCIuL2NhbnZhcy9DYW52YXNcIik7XHJcbmNvbnN0IE51bGxUb29sXzEgPSByZXF1aXJlKFwiLi90b29scy9OdWxsVG9vbFwiKTtcclxuY29uc3QgVG9vbEZhY3RvcnlfMSA9IHJlcXVpcmUoXCIuL3Rvb2xzL1Rvb2xGYWN0b3J5XCIpO1xyXG5jb25zdCBCb2FyZFN0b3JhZ2VfMSA9IHJlcXVpcmUoXCIuL3V0aWwvQm9hcmRTdG9yYWdlXCIpO1xyXG5jb25zdCBDb250cm9sXzEgPSByZXF1aXJlKFwiLi91dGlsL0NvbnRyb2xcIik7XHJcbmNvbnN0IE1vdXNlXzEgPSByZXF1aXJlKFwiLi91dGlsL01vdXNlXCIpO1xyXG5jb25zdCBQcm9wZXJ0aWVzXzEgPSByZXF1aXJlKFwiLi91dGlsL1Byb3BlcnRpZXNcIik7XHJcbmNsYXNzIERyYXdpbmcge1xyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgdGhpcy50b29sID0gTnVsbFRvb2xfMS5OdWxsVG9vbC5JbnN0YW5jZTtcclxuICAgICAgICB0aGlzLnN0YXJ0RHJhdyA9IChlKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChDb250cm9sXzEuQ29udHJvbC5pc0NvbnRyb2xFbGVtKGUudGFyZ2V0KSlcclxuICAgICAgICAgICAgICAgIHJldHVybjsgLy9yZXR1cm5zIGlmIGVsZW1lbnQgaXMgY29udHJvbCBlbGVtICh0b29sLCBjb2xvciBwaWNrZXIgZXRjLilcclxuICAgICAgICAgICAgdGhpcy50b29sID0gVG9vbEZhY3RvcnlfMS5Ub29sRmFjdG9yeS5nZXRUb29sKEJvYXJkU3RvcmFnZV8xLkJvYXJkU3RvcmFnZS5nZXQoXCJ0b29sXCIpLCB0aGlzLmNhbnZhcywgUHJvcGVydGllc18xLlByb3BlcnRpZXMubG9jYWwpO1xyXG4gICAgICAgICAgICB0aGlzLnRvb2wuc3RhcnREcmF3KE1vdXNlXzEuTW91c2UuZ2V0UG9zaXRpb24oZSkpO1xyXG4gICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcInBvaW50ZXJtb3ZlXCIsIHRoaXMuZHJhdywgZmFsc2UpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgdGhpcy5kcmF3ID0gKGUpID0+IHRoaXMudG9vbC5hZGRQb2ludChNb3VzZV8xLk1vdXNlLmdldFBvc2l0aW9uKGUpKTtcclxuICAgICAgICB0aGlzLmVuZERyYXcgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKFwicG9pbnRlcm1vdmVcIiwgdGhpcy5kcmF3LCBmYWxzZSk7XHJcbiAgICAgICAgICAgIHRoaXMudG9vbC5lbmREcmF3KCk7XHJcbiAgICAgICAgICAgIHRoaXMudG9vbCA9IE51bGxUb29sXzEuTnVsbFRvb2wuSW5zdGFuY2U7XHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLmNhbnZhcyA9IG5ldyBDYW52YXNfMS5DYW52YXMoKTtcclxuICAgICAgICBDb250cm9sXzEuQ29udHJvbC5zZXR1cExpc3RlbmVycygpO1xyXG4gICAgICAgIHRoaXMuYXBwZW5kTGlzdGVuZXJzKCk7XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgc2V0dXAoKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmluc3RhbmNlKVxyXG4gICAgICAgICAgICB0aGlzLmluc3RhbmNlID0gbmV3IHRoaXMoKTtcclxuICAgIH1cclxuICAgIGFwcGVuZExpc3RlbmVycygpIHtcclxuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcInBvaW50ZXJkb3duXCIsIHRoaXMuc3RhcnREcmF3LCBmYWxzZSk7XHJcbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJwb2ludGVydXBcIiwgdGhpcy5lbmREcmF3LCBmYWxzZSk7XHJcbiAgICB9XHJcbn1cclxuZXhwb3J0cy5EcmF3aW5nID0gRHJhd2luZztcclxuIiwiXCJ1c2Ugc3RyaWN0XCI7XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuZXhwb3J0cy5DYW52YXMgPSB2b2lkIDA7XHJcbmNvbnN0IENvbmZpZ18xID0gcmVxdWlyZShcIi4vQ29uZmlnXCIpO1xyXG5jbGFzcyBDYW52YXMge1xyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgdGhpcy5fY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKTtcclxuICAgICAgICB0aGlzLl9jYW52YXMud2lkdGggPSB3aW5kb3cuc2NyZWVuLmF2YWlsV2lkdGg7XHJcbiAgICAgICAgdGhpcy5fY2FudmFzLmhlaWdodCA9IHdpbmRvdy5zY3JlZW4uYXZhaWxIZWlnaHQ7XHJcbiAgICAgICAgdGhpcy5fY3R4ID0gdGhpcy5fY2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcclxuICAgICAgICB0aGlzLnNldHVwKCk7XHJcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0aGlzLl9jYW52YXMpO1xyXG4gICAgfVxyXG4gICAgc2V0dXAoKSB7XHJcbiAgICAgICAgdGhpcy5jdHgubGluZUpvaW4gPSBDb25maWdfMS5Db25maWcubGluZUpvaW47XHJcbiAgICAgICAgdGhpcy5jdHgubGluZUNhcCA9IENvbmZpZ18xLkNvbmZpZy5saW5lQ2FwO1xyXG4gICAgfVxyXG4gICAgc2V0Q29sb3IoY29sb3IpIHtcclxuICAgICAgICB0aGlzLl9jdHguc3Ryb2tlU3R5bGUgPSBjb2xvcjtcclxuICAgICAgICB0aGlzLl9jdHguZmlsbFN0eWxlID0gY29sb3I7XHJcbiAgICB9XHJcbiAgICBzZXRMaW5lV2lkdGgobGluZVdpZHRoKSB7XHJcbiAgICAgICAgdGhpcy5fY3R4LmxpbmVXaWR0aCA9IGxpbmVXaWR0aDtcclxuICAgIH1cclxuICAgIGNsZWFyKCkge1xyXG4gICAgICAgIHRoaXMuX2N0eC5jbGVhclJlY3QoMCwgMCwgdGhpcy5fY2FudmFzLndpZHRoLCB0aGlzLl9jYW52YXMuaGVpZ2h0KTtcclxuICAgIH1cclxuICAgIGdldCBjYW52YXMoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NhbnZhcztcclxuICAgIH1cclxuICAgIGdldCBjdHgoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2N0eDtcclxuICAgIH1cclxufVxyXG5leHBvcnRzLkNhbnZhcyA9IENhbnZhcztcclxuIiwiXCJ1c2Ugc3RyaWN0XCI7XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuZXhwb3J0cy5Db25maWcgPSB2b2lkIDA7XHJcbmNvbnN0IENvbmZpZyA9IHtcclxuICAgIGxpbmVKb2luOiBcInJvdW5kXCIsXHJcbiAgICBsaW5lQ2FwOiBcInJvdW5kXCIsXHJcbiAgICBjYW5EcmF3OiBmYWxzZSxcclxufTtcclxuZXhwb3J0cy5Db25maWcgPSBDb25maWc7XHJcbiIsIlwidXNlIHN0cmljdFwiO1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbmV4cG9ydHMuTWFpbkNhbnZhcyA9IHZvaWQgMDtcclxuY29uc3QgQ2FudmFzXzEgPSByZXF1aXJlKFwiLi9DYW52YXNcIik7XHJcbmNvbnN0IEJvYXJkU3RvcmFnZV8xID0gcmVxdWlyZShcIi4uL3V0aWwvQm9hcmRTdG9yYWdlXCIpO1xyXG5jbGFzcyBNYWluQ2FudmFzIGV4dGVuZHMgQ2FudmFzXzEuQ2FudmFzIHtcclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHN1cGVyKCk7XHJcbiAgICAgICAgdGhpcy5kcmF3V2hpdGVCYWNrZ3JvdW5kKCk7XHJcbiAgICAgICAgdGhpcy5kcmF3RnJvbVN0b3JhZ2UoKTtcclxuICAgICAgICB0aGlzLnNlbmRUb0JhY2soKTtcclxuICAgIH1cclxuICAgIHN0YXRpYyBjcmVhdGUoKSB7XHJcbiAgICAgICAgdGhpcy5JbnN0YW5jZTtcclxuICAgIH1cclxuICAgIHN0YXRpYyBnZXQgSW5zdGFuY2UoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2luc3RhbmNlIHx8ICh0aGlzLl9pbnN0YW5jZSA9IG5ldyB0aGlzKCkpO1xyXG4gICAgfVxyXG4gICAgZHJhd1doaXRlQmFja2dyb3VuZCgpIHtcclxuICAgICAgICBsZXQgcHJldkZpbGxTdHlsZSA9IHRoaXMuY3R4LmZpbGxTdHlsZTtcclxuICAgICAgICB0aGlzLmN0eC5maWxsU3R5bGUgPSAnd2hpdGUnO1xyXG4gICAgICAgIHRoaXMuY3R4LmZpbGxSZWN0KDAsIDAsIHRoaXMuY2FudmFzLndpZHRoLCB0aGlzLmNhbnZhcy5oZWlnaHQpO1xyXG4gICAgICAgIHRoaXMuY3R4LmZpbGxTdHlsZSA9IHByZXZGaWxsU3R5bGU7XHJcbiAgICB9XHJcbiAgICBkcmF3RnJvbVN0b3JhZ2UoKSB7XHJcbiAgICAgICAgbGV0IGltZ1NyYyA9IEJvYXJkU3RvcmFnZV8xLkJvYXJkU3RvcmFnZS5nZXQoXCJpbWdcIik7XHJcbiAgICAgICAgaWYgKCFpbWdTcmMpXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICBsZXQgaW1nID0gbmV3IEltYWdlKCk7XHJcbiAgICAgICAgaW1nLnNyYyA9IGltZ1NyYztcclxuICAgICAgICBpbWcuYWRkRXZlbnRMaXN0ZW5lcihcImxvYWRcIiwgKCkgPT4gdGhpcy5jdHguZHJhd0ltYWdlKGltZywgMCwgMCkpO1xyXG4gICAgfVxyXG4gICAgc2VuZFRvQmFjaygpIHtcclxuICAgICAgICB0aGlzLmNhbnZhcy5zdHlsZS56SW5kZXggPSBcIi0xMDAwXCI7XHJcbiAgICB9XHJcbiAgICBkcmF3SW1hZ2UoY2FudmFzKSB7XHJcbiAgICAgICAgdGhpcy5jdHguZHJhd0ltYWdlKGNhbnZhcywgMCwgMCk7XHJcbiAgICB9XHJcbiAgICBzYXZlSW5TdG9yYWdlKCkge1xyXG4gICAgICAgIGxldCBpbWcgPSB0aGlzLmdldEltZ1NyYygpO1xyXG4gICAgICAgIEJvYXJkU3RvcmFnZV8xLkJvYXJkU3RvcmFnZS5zZXQoXCJpbWdcIiwgaW1nKTtcclxuICAgIH1cclxuICAgIGdldEltZ1NyYygpIHtcclxuICAgICAgICBsZXQgaW1nZCA9IHRoaXMuY3R4LmdldEltYWdlRGF0YSgwLCAwLCB0aGlzLmNhbnZhcy53aWR0aCwgdGhpcy5jYW52YXMuaGVpZ2h0KTtcclxuICAgICAgICB0aGlzLmN0eC5jbGVhclJlY3QoMCwgMCwgdGhpcy5jYW52YXMud2lkdGgsIHRoaXMuY2FudmFzLmhlaWdodCk7XHJcbiAgICAgICAgdGhpcy5jdHgucHV0SW1hZ2VEYXRhKGltZ2QsIDAsIDApO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNhbnZhcy50b0RhdGFVUkwoXCJpbWFnZS9wbmdcIik7XHJcbiAgICB9XHJcbn1cclxuZXhwb3J0cy5NYWluQ2FudmFzID0gTWFpbkNhbnZhcztcclxuIiwiXCJ1c2Ugc3RyaWN0XCI7XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuZXhwb3J0cy5CcnVzaCA9IHZvaWQgMDtcclxuY29uc3QgVG9vbF8xID0gcmVxdWlyZShcIi4vVG9vbFwiKTtcclxuY2xhc3MgQnJ1c2ggZXh0ZW5kcyBUb29sXzEuVG9vbCB7XHJcbiAgICBwcmVwYXJlKCkge1xyXG4gICAgICAgIHRoaXMuY2FudmFzLnNldENvbG9yKHRoaXMucHJvcGVydGllcy5jb2xvcik7XHJcbiAgICAgICAgdGhpcy5jYW52YXMuc2V0TGluZVdpZHRoKHRoaXMucHJvcGVydGllcy5saW5lV2lkdGgpO1xyXG4gICAgfVxyXG59XHJcbmV4cG9ydHMuQnJ1c2ggPSBCcnVzaDtcclxuQnJ1c2guX3Rvb2xOYW1lID0gXCJicnVzaFwiO1xyXG4iLCJcInVzZSBzdHJpY3RcIjtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG5leHBvcnRzLkVyYXNlciA9IHZvaWQgMDtcclxuY29uc3QgVG9vbF8xID0gcmVxdWlyZShcIi4vVG9vbFwiKTtcclxuY2xhc3MgRXJhc2VyIGV4dGVuZHMgVG9vbF8xLlRvb2wge1xyXG4gICAgcHJlcGFyZSgpIHtcclxuICAgICAgICB0aGlzLmNhbnZhcy5zZXRDb2xvcihcIiNmZmZmZmZcIik7XHJcbiAgICAgICAgdGhpcy5jYW52YXMuc2V0TGluZVdpZHRoKHRoaXMucHJvcGVydGllcy5saW5lV2lkdGgpO1xyXG4gICAgfVxyXG59XHJcbmV4cG9ydHMuRXJhc2VyID0gRXJhc2VyO1xyXG5FcmFzZXIuX3Rvb2xOYW1lID0gXCJlcmFzZXJcIjtcclxuIiwiXCJ1c2Ugc3RyaWN0XCI7XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuZXhwb3J0cy5OdWxsVG9vbCA9IHZvaWQgMDtcclxuY29uc3QgUHJvcGVydGllc18xID0gcmVxdWlyZShcIi4uL3V0aWwvUHJvcGVydGllc1wiKTtcclxuY29uc3QgVG9vbF8xID0gcmVxdWlyZShcIi4vVG9vbFwiKTtcclxuY2xhc3MgTnVsbFRvb2wgZXh0ZW5kcyBUb29sXzEuVG9vbCB7XHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICBzdXBlcih7fSwgUHJvcGVydGllc18xLlByb3BlcnRpZXMubG9jYWwpO1xyXG4gICAgfVxyXG4gICAgc3RhdGljIGdldCBJbnN0YW5jZSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5faW5zdGFuY2UgfHwgKHRoaXMuX2luc3RhbmNlID0gbmV3IHRoaXMoKSk7XHJcbiAgICB9XHJcbiAgICAvL292ZXJ3cml0ZVxyXG4gICAgYWRkUG9pbnQoKSB7IH1cclxuICAgIDtcclxuICAgIHN0YXJ0RHJhdygpIHsgfVxyXG4gICAgO1xyXG4gICAgZW5kRHJhdygpIHsgfVxyXG4gICAgO1xyXG4gICAgcHJlcGFyZSgpIHsgfVxyXG4gICAgO1xyXG59XHJcbmV4cG9ydHMuTnVsbFRvb2wgPSBOdWxsVG9vbDtcclxuTnVsbFRvb2wuX3Rvb2xOYW1lID0gXCJub25lXCI7XHJcbiIsIlwidXNlIHN0cmljdFwiO1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbmV4cG9ydHMuVG9vbCA9IHZvaWQgMDtcclxuY29uc3QgTWFpbkNhbnZhc18xID0gcmVxdWlyZShcIi4uL2NhbnZhcy9NYWluQ2FudmFzXCIpO1xyXG5jbGFzcyBUb29sIHtcclxuICAgIGNvbnN0cnVjdG9yKGNhbnZhcywgcHJvcGVydGllcykge1xyXG4gICAgICAgIHRoaXMuY2FudmFzID0gY2FudmFzO1xyXG4gICAgICAgIHRoaXMucHJvcGVydGllcyA9IHByb3BlcnRpZXM7XHJcbiAgICAgICAgdGhpcy5wb2ludHMgPSBbXTtcclxuICAgIH1cclxuICAgIHN0YXRpYyBnZXQgdG9vbE5hbWUoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3Rvb2xOYW1lO1xyXG4gICAgfVxyXG4gICAgYWRkUG9pbnQocG9pbnQpIHtcclxuICAgICAgICB0aGlzLnBvaW50cy5wdXNoKHBvaW50KTtcclxuICAgICAgICB0aGlzLmRyYXcoKTtcclxuICAgIH1cclxuICAgIHN0YXJ0RHJhdyhwb2ludCkge1xyXG4gICAgICAgIHRoaXMucHJlcGFyZSgpO1xyXG4gICAgICAgIHRoaXMuYWRkUG9pbnQocG9pbnQpO1xyXG4gICAgfVxyXG4gICAgO1xyXG4gICAgZHJhdygpIHtcclxuICAgICAgICBpZiAodGhpcy5wb2ludHMubGVuZ3RoIDwgMykge1xyXG4gICAgICAgICAgICBsZXQgYiA9IHRoaXMucG9pbnRzWzBdO1xyXG4gICAgICAgICAgICB0aGlzLmNhbnZhcy5jdHguYmVnaW5QYXRoKCk7XHJcbiAgICAgICAgICAgIHRoaXMuY2FudmFzLmN0eC5hcmMoYi54LCBiLnksIHRoaXMuY2FudmFzLmN0eC5saW5lV2lkdGggLyAyLCAwLCBNYXRoLlBJICogMiwgITApO1xyXG4gICAgICAgICAgICB0aGlzLmNhbnZhcy5jdHguZmlsbCgpO1xyXG4gICAgICAgICAgICB0aGlzLmNhbnZhcy5jdHguY2xvc2VQYXRoKCk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5jYW52YXMuY3R4LmNsZWFyUmVjdCgwLCAwLCB0aGlzLmNhbnZhcy5jYW52YXMud2lkdGgsIHRoaXMuY2FudmFzLmNhbnZhcy5oZWlnaHQpO1xyXG4gICAgICAgIHRoaXMuY2FudmFzLmN0eC5iZWdpblBhdGgoKTtcclxuICAgICAgICB0aGlzLmNhbnZhcy5jdHgubW92ZVRvKHRoaXMucG9pbnRzWzBdLngsIHRoaXMucG9pbnRzWzBdLnkpO1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgdGhpcy5wb2ludHMubGVuZ3RoIC0gMjsgaSsrKSB7IC8vVGhpcyBtYWtlIGxpbmUgc21vb3RoZXJcclxuICAgICAgICAgICAgbGV0IGMgPSAodGhpcy5wb2ludHNbaV0ueCArIHRoaXMucG9pbnRzW2kgKyAxXS54KSAvIDI7XHJcbiAgICAgICAgICAgIGxldCBkID0gKHRoaXMucG9pbnRzW2ldLnkgKyB0aGlzLnBvaW50c1tpICsgMV0ueSkgLyAyO1xyXG4gICAgICAgICAgICB0aGlzLmNhbnZhcy5jdHgucXVhZHJhdGljQ3VydmVUbyh0aGlzLnBvaW50c1tpXS54LCB0aGlzLnBvaW50c1tpXS55LCBjLCBkKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IGkgPSB0aGlzLnBvaW50cy5sZW5ndGggLSAyO1xyXG4gICAgICAgIHRoaXMuY2FudmFzLmN0eC5xdWFkcmF0aWNDdXJ2ZVRvKHRoaXMucG9pbnRzW2ldLngsIHRoaXMucG9pbnRzW2ldLnksIHRoaXMucG9pbnRzW2kgKyAxXS54LCB0aGlzLnBvaW50c1tpICsgMV0ueSk7XHJcbiAgICAgICAgdGhpcy5jYW52YXMuY3R4LnN0cm9rZSgpO1xyXG4gICAgfVxyXG4gICAgO1xyXG4gICAgZW5kRHJhdygpIHtcclxuICAgICAgICBNYWluQ2FudmFzXzEuTWFpbkNhbnZhcy5JbnN0YW5jZS5kcmF3SW1hZ2UodGhpcy5jYW52YXMuY2FudmFzKTtcclxuICAgICAgICBNYWluQ2FudmFzXzEuTWFpbkNhbnZhcy5JbnN0YW5jZS5zYXZlSW5TdG9yYWdlKCk7XHJcbiAgICAgICAgdGhpcy5jYW52YXMuY2xlYXIoKTtcclxuICAgIH1cclxuICAgIDtcclxufVxyXG5leHBvcnRzLlRvb2wgPSBUb29sO1xyXG4iLCJcInVzZSBzdHJpY3RcIjtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG5leHBvcnRzLlRvb2xGYWN0b3J5ID0gdm9pZCAwO1xyXG5jb25zdCBCcnVzaF8xID0gcmVxdWlyZShcIi4vQnJ1c2hcIik7XHJcbmNvbnN0IEVyYXNlcl8xID0gcmVxdWlyZShcIi4vRXJhc2VyXCIpO1xyXG5jbGFzcyBUb29sRmFjdG9yeSB7XHJcbiAgICBzdGF0aWMgZ2V0VG9vbCh0b29sTmFtZSwgY2FudmFzLCBwcm9wZXJ0aWVzKSB7XHJcbiAgICAgICAgc3dpdGNoICh0b29sTmFtZSkge1xyXG4gICAgICAgICAgICBjYXNlIEJydXNoXzEuQnJ1c2gudG9vbE5hbWU6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEJydXNoXzEuQnJ1c2goY2FudmFzLCBwcm9wZXJ0aWVzKTtcclxuICAgICAgICAgICAgY2FzZSBFcmFzZXJfMS5FcmFzZXIudG9vbE5hbWU6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEVyYXNlcl8xLkVyYXNlcihjYW52YXMsIHByb3BlcnRpZXMpO1xyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBUb29sIG5hbWVcIik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbmV4cG9ydHMuVG9vbEZhY3RvcnkgPSBUb29sRmFjdG9yeTtcclxuIiwiXCJ1c2Ugc3RyaWN0XCI7XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuZXhwb3J0cy5Cb2FyZFN0b3JhZ2UgPSB2b2lkIDA7XHJcbmNvbnN0IFZhbGlkXzEgPSByZXF1aXJlKFwiLi9WYWxpZFwiKTtcclxuY2xhc3MgQm9hcmRTdG9yYWdlIHtcclxuICAgIHN0YXRpYyBzZXQoa2V5LCB2YWx1ZSkge1xyXG4gICAgICAgIGlmICh0eXBlb2YgdmFsdWUgIT09IFwib2JqZWN0XCIpXHJcbiAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oa2V5LCB2YWx1ZSk7XHJcbiAgICAgICAgdmFsdWUgPSBKU09OLnN0cmluZ2lmeSh2YWx1ZSk7XHJcbiAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbShrZXksIHZhbHVlKTtcclxuICAgIH1cclxuICAgIHN0YXRpYyBnZXQoa2V5KSB7XHJcbiAgICAgICAgbGV0IGl0ZW0gPSBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKGtleSk7XHJcbiAgICAgICAgaWYgKCFWYWxpZF8xLlZhbGlkLmlzSlNPTihpdGVtKSlcclxuICAgICAgICAgICAgcmV0dXJuIGl0ZW07XHJcbiAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UoaXRlbSk7XHJcbiAgICB9XHJcbn1cclxuZXhwb3J0cy5Cb2FyZFN0b3JhZ2UgPSBCb2FyZFN0b3JhZ2U7XHJcbiIsIlwidXNlIHN0cmljdFwiO1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbmV4cG9ydHMuQ29udHJvbCA9IHZvaWQgMDtcclxuY29uc3QgQm9hcmRTdG9yYWdlXzEgPSByZXF1aXJlKFwiLi9Cb2FyZFN0b3JhZ2VcIik7XHJcbmNsYXNzIENvbnRyb2wge1xyXG4gICAgc3RhdGljIGlzQ29udHJvbEVsZW0oZWxlbSkge1xyXG4gICAgICAgIGxldCBpc1Rvb2xFbGVtID0gZmFsc2U7XHJcbiAgICAgICAgQXJyYXkuZnJvbSh0aGlzLmVsZW1lbnRzLnRvb2xzLmNoaWxkcmVuKS5mb3JFYWNoKGNoaWxkID0+IHtcclxuICAgICAgICAgICAgaWYgKGNoaWxkLmNsYXNzTmFtZSA9PSBlbGVtLmNsYXNzTmFtZSkge1xyXG4gICAgICAgICAgICAgICAgaXNUb29sRWxlbSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gKGlzVG9vbEVsZW0gfHwgZWxlbS5jbGFzc05hbWUgPT0gdGhpcy5lbGVtZW50cy5jb2xvck91dHB1dC5jbGFzc05hbWUgfHwgZWxlbS5jbGFzc05hbWUgPT0gdGhpcy5lbGVtZW50cy5jb2xvcklucHV0LmNsYXNzTmFtZSB8fCBlbGVtLmNsYXNzTmFtZSA9PSB0aGlzLmVsZW1lbnRzLmxpbmVXaWR0aElucHV0LmNsYXNzTmFtZSB8fCBlbGVtLmNsYXNzTmFtZSA9PSB0aGlzLmVsZW1lbnRzLmxpbmVXaWR0aE91dHB1dC5jbGFzc05hbWUgfHwgZWxlbS5jbGFzc05hbWUgPT0gdGhpcy5lbGVtZW50cy5kb3dubG9hZC5jbGFzc05hbWUpO1xyXG4gICAgfVxyXG4gICAgc3RhdGljIHNldHVwTGlzdGVuZXJzKCkge1xyXG4gICAgICAgIHRoaXMuZWxlbWVudHMubGluZVdpZHRoSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsIGUgPT4gdGhpcy5zZXRMaW5lV2lkdGgoK2UudGFyZ2V0LnZhbHVlKSk7XHJcbiAgICAgICAgdGhpcy5lbGVtZW50cy5jb2xvcklucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCBlID0+IHRoaXMuc2V0Q29sb3IoZS50YXJnZXQudmFsdWUpKTtcclxuICAgICAgICB0aGlzLmVsZW1lbnRzLnRvb2xzLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBlID0+IHRoaXMuc2V0VG9vbChlLnRhcmdldC5jbGFzc05hbWUpKTtcclxuICAgICAgICB0aGlzLmVsZW1lbnRzLmRvd25sb2FkLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB0aGlzLmRvd25sb2FkSW1hZ2UoKSk7XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgc2V0dXBJbml0aWFsUHJvcGVydGllcygpIHtcclxuICAgICAgICB0aGlzLnNldENvbG9yKEJvYXJkU3RvcmFnZV8xLkJvYXJkU3RvcmFnZS5nZXQoXCJjb2xvclwiKSB8fCBcIiMwMDAwMDBcIik7XHJcbiAgICAgICAgdGhpcy5zZXRMaW5lV2lkdGgoQm9hcmRTdG9yYWdlXzEuQm9hcmRTdG9yYWdlLmdldChcImxpbmVXaWR0aFwiKSB8fCAxMCk7XHJcbiAgICAgICAgdGhpcy5zZXRUb29sKEJvYXJkU3RvcmFnZV8xLkJvYXJkU3RvcmFnZS5nZXQoXCJ0b29sXCIpIHx8IFwiYnJ1c2hcIik7XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgc2V0Q29sb3IoY29sb3IpIHtcclxuICAgICAgICBCb2FyZFN0b3JhZ2VfMS5Cb2FyZFN0b3JhZ2Uuc2V0KFwiY29sb3JcIiwgY29sb3IpO1xyXG4gICAgICAgIHRoaXMuZWxlbWVudHMuY29sb3JPdXRwdXQuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gY29sb3I7XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgc2V0TGluZVdpZHRoKHNpemUpIHtcclxuICAgICAgICBCb2FyZFN0b3JhZ2VfMS5Cb2FyZFN0b3JhZ2Uuc2V0KFwibGluZVdpZHRoXCIsIHNpemUudG9TdHJpbmcoKSk7XHJcbiAgICAgICAgdGhpcy5lbGVtZW50cy5saW5lV2lkdGhPdXRwdXQudmFsdWUgPSBzaXplLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgdGhpcy5lbGVtZW50cy5saW5lV2lkdGhJbnB1dC52YWx1ZSA9IHNpemUudG9TdHJpbmcoKTtcclxuICAgIH1cclxuICAgIHN0YXRpYyBzZXRUb29sKHRvb2wpIHtcclxuICAgICAgICBpZiAodG9vbCA9PSBcInRvb2xzXCIpXHJcbiAgICAgICAgICAgIHJldHVybjsgLy8gSWYgdXNlciBjbGljayBvbiBuYXYgKCBub3Qgb24gdG9vbCBpY29uICkganVzdCByZXR1cm4uXHJcbiAgICAgICAgQm9hcmRTdG9yYWdlXzEuQm9hcmRTdG9yYWdlLnNldChcInRvb2xcIiwgdG9vbCk7XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgZG93bmxvYWRJbWFnZSgpIHtcclxuICAgICAgICBsZXQgaW1hZ2UgPSBCb2FyZFN0b3JhZ2VfMS5Cb2FyZFN0b3JhZ2UuZ2V0KFwiaW1nXCIpO1xyXG4gICAgICAgIHRoaXMuZWxlbWVudHMuZG93bmxvYWQuaHJlZiA9IGltYWdlO1xyXG4gICAgfVxyXG59XHJcbmV4cG9ydHMuQ29udHJvbCA9IENvbnRyb2w7XHJcbkNvbnRyb2wuZWxlbWVudHMgPSB7XHJcbiAgICBjb2xvck91dHB1dDogZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShcImNvbG9yLWxhYmVsLWVsZW1lbnRcIilbMF0sXHJcbiAgICBjb2xvcklucHV0OiBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwiY29sb3JcIilbMF0sXHJcbiAgICBsaW5lV2lkdGhPdXRwdXQ6IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJwYWludC1zaXplLW91dFwiKVswXSxcclxuICAgIGxpbmVXaWR0aElucHV0OiBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwicGFpbnQtc2l6ZS1pblwiKVswXSxcclxuICAgIHRvb2xzOiBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwidG9vbHNcIilbMF0sXHJcbiAgICBkb3dubG9hZDogZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShcImRvd25sb2FkXCIpWzBdXHJcbn07XHJcbiIsIlwidXNlIHN0cmljdFwiO1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbmV4cG9ydHMuTW91c2UgPSB2b2lkIDA7XHJcbmNvbnN0IFBvaW50XzEgPSByZXF1aXJlKFwiLi9Qb2ludFwiKTtcclxuY2xhc3MgTW91c2Uge1xyXG4gICAgc3RhdGljIGdldFBvc2l0aW9uKGV2ZW50KSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBQb2ludF8xLlBvaW50KGV2ZW50LnBhZ2VYLCBldmVudC5wYWdlWSk7XHJcbiAgICB9XHJcbn1cclxuZXhwb3J0cy5Nb3VzZSA9IE1vdXNlO1xyXG4iLCJcInVzZSBzdHJpY3RcIjtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG5leHBvcnRzLlBvaW50ID0gdm9pZCAwO1xyXG5jbGFzcyBQb2ludCB7XHJcbiAgICBjb25zdHJ1Y3Rvcih4LCB5KSB7XHJcbiAgICAgICAgdGhpcy5feCA9IHg7XHJcbiAgICAgICAgdGhpcy5feSA9IHk7XHJcbiAgICB9XHJcbiAgICBnZXQgeCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5feDtcclxuICAgIH1cclxuICAgIGdldCB5KCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl95O1xyXG4gICAgfVxyXG59XHJcbmV4cG9ydHMuUG9pbnQgPSBQb2ludDtcclxuIiwiXCJ1c2Ugc3RyaWN0XCI7XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuZXhwb3J0cy5Qcm9wZXJ0aWVzID0gdm9pZCAwO1xyXG5jb25zdCBCb2FyZFN0b3JhZ2VfMSA9IHJlcXVpcmUoXCIuL0JvYXJkU3RvcmFnZVwiKTtcclxuY2xhc3MgUHJvcGVydGllcyB7XHJcbiAgICBjb25zdHJ1Y3RvcihsaW5lV2lkdGgsIGNvbG9yKSB7XHJcbiAgICAgICAgdGhpcy5fbGluZVdpZHRoID0gbGluZVdpZHRoO1xyXG4gICAgICAgIHRoaXMuX2NvbG9yID0gY29sb3I7XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgZ2V0IGxvY2FsKCkge1xyXG4gICAgICAgIHJldHVybiBuZXcgdGhpcygrQm9hcmRTdG9yYWdlXzEuQm9hcmRTdG9yYWdlLmdldChcImxpbmVXaWR0aFwiKSwgQm9hcmRTdG9yYWdlXzEuQm9hcmRTdG9yYWdlLmdldChcImNvbG9yXCIpKTtcclxuICAgIH1cclxuICAgIGdldCBsaW5lV2lkdGgoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2xpbmVXaWR0aDtcclxuICAgIH1cclxuICAgIGdldCBjb2xvcigpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fY29sb3I7XHJcbiAgICB9XHJcbn1cclxuZXhwb3J0cy5Qcm9wZXJ0aWVzID0gUHJvcGVydGllcztcclxuIiwiXCJ1c2Ugc3RyaWN0XCI7XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuZXhwb3J0cy5WYWxpZCA9IHZvaWQgMDtcclxuY2xhc3MgVmFsaWQge1xyXG4gICAgc3RhdGljIGlzSlNPTihzKSB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgSlNPTi5wYXJzZShzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxufVxyXG5leHBvcnRzLlZhbGlkID0gVmFsaWQ7XHJcbiIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdHZhciBjYWNoZWRNb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdO1xuXHRpZiAoY2FjaGVkTW9kdWxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRyZXR1cm4gY2FjaGVkTW9kdWxlLmV4cG9ydHM7XG5cdH1cblx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcblx0dmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7XG5cdFx0Ly8gbm8gbW9kdWxlLmlkIG5lZWRlZFxuXHRcdC8vIG5vIG1vZHVsZS5sb2FkZWQgbmVlZGVkXG5cdFx0ZXhwb3J0czoge31cblx0fTtcblxuXHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cblx0X193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0obW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cblx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcblx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xufVxuXG4iLCJcInVzZSBzdHJpY3RcIjtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG5jb25zdCBEcmF3aW5nXzEgPSByZXF1aXJlKFwiLi9EcmF3aW5nXCIpO1xyXG5jb25zdCBNYWluQ2FudmFzXzEgPSByZXF1aXJlKFwiLi9jYW52YXMvTWFpbkNhbnZhc1wiKTtcclxuY29uc3QgQ29udHJvbF8xID0gcmVxdWlyZShcIi4vdXRpbC9Db250cm9sXCIpO1xyXG5jbGFzcyBNYWluIHtcclxuICAgIHN0YXRpYyBydW4oKSB7XHJcbiAgICAgICAgQ29udHJvbF8xLkNvbnRyb2wuc2V0dXBJbml0aWFsUHJvcGVydGllcygpO1xyXG4gICAgICAgIE1haW5DYW52YXNfMS5NYWluQ2FudmFzLmNyZWF0ZSgpO1xyXG4gICAgICAgIERyYXdpbmdfMS5EcmF3aW5nLnNldHVwKCk7XHJcbiAgICB9XHJcbn1cclxuTWFpbi5ydW4oKTtcclxuIl0sIm5hbWVzIjpbIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwiRHJhd2luZyIsIkNhbnZhc18xIiwiTnVsbFRvb2xfMSIsIlRvb2xGYWN0b3J5XzEiLCJCb2FyZFN0b3JhZ2VfMSIsIkNvbnRyb2xfMSIsIk1vdXNlXzEiLCJQcm9wZXJ0aWVzXzEiLCJjb25zdHJ1Y3RvciIsInRoaXMiLCJ0b29sIiwiTnVsbFRvb2wiLCJJbnN0YW5jZSIsInN0YXJ0RHJhdyIsImUiLCJDb250cm9sIiwiaXNDb250cm9sRWxlbSIsInRhcmdldCIsIlRvb2xGYWN0b3J5IiwiZ2V0VG9vbCIsIkJvYXJkU3RvcmFnZSIsImdldCIsImNhbnZhcyIsIlByb3BlcnRpZXMiLCJsb2NhbCIsIk1vdXNlIiwiZ2V0UG9zaXRpb24iLCJ3aW5kb3ciLCJhZGRFdmVudExpc3RlbmVyIiwiZHJhdyIsImFkZFBvaW50IiwiZW5kRHJhdyIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJDYW52YXMiLCJzZXR1cExpc3RlbmVycyIsImFwcGVuZExpc3RlbmVycyIsInN0YXRpYyIsImluc3RhbmNlIiwiQ29uZmlnXzEiLCJfY2FudmFzIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50Iiwid2lkdGgiLCJzY3JlZW4iLCJhdmFpbFdpZHRoIiwiaGVpZ2h0IiwiYXZhaWxIZWlnaHQiLCJfY3R4IiwiZ2V0Q29udGV4dCIsInNldHVwIiwiYm9keSIsImFwcGVuZENoaWxkIiwiY3R4IiwibGluZUpvaW4iLCJDb25maWciLCJsaW5lQ2FwIiwic2V0Q29sb3IiLCJjb2xvciIsInN0cm9rZVN0eWxlIiwiZmlsbFN0eWxlIiwic2V0TGluZVdpZHRoIiwibGluZVdpZHRoIiwiY2xlYXIiLCJjbGVhclJlY3QiLCJjYW5EcmF3IiwiTWFpbkNhbnZhcyIsInN1cGVyIiwiZHJhd1doaXRlQmFja2dyb3VuZCIsImRyYXdGcm9tU3RvcmFnZSIsInNlbmRUb0JhY2siLCJfaW5zdGFuY2UiLCJwcmV2RmlsbFN0eWxlIiwiZmlsbFJlY3QiLCJpbWdTcmMiLCJpbWciLCJJbWFnZSIsInNyYyIsImRyYXdJbWFnZSIsInN0eWxlIiwiekluZGV4Iiwic2F2ZUluU3RvcmFnZSIsImdldEltZ1NyYyIsInNldCIsImltZ2QiLCJnZXRJbWFnZURhdGEiLCJwdXRJbWFnZURhdGEiLCJ0b0RhdGFVUkwiLCJCcnVzaCIsIlRvb2xfMSIsIlRvb2wiLCJwcmVwYXJlIiwicHJvcGVydGllcyIsIl90b29sTmFtZSIsIkVyYXNlciIsIk1haW5DYW52YXNfMSIsInBvaW50cyIsInRvb2xOYW1lIiwicG9pbnQiLCJwdXNoIiwibGVuZ3RoIiwiYiIsImJlZ2luUGF0aCIsImFyYyIsIngiLCJ5IiwiTWF0aCIsIlBJIiwiZmlsbCIsImNsb3NlUGF0aCIsIm1vdmVUbyIsImkiLCJjIiwiZCIsInF1YWRyYXRpY0N1cnZlVG8iLCJzdHJva2UiLCJCcnVzaF8xIiwiRXJhc2VyXzEiLCJFcnJvciIsIlZhbGlkXzEiLCJrZXkiLCJzZXNzaW9uU3RvcmFnZSIsInNldEl0ZW0iLCJKU09OIiwic3RyaW5naWZ5IiwiaXRlbSIsImdldEl0ZW0iLCJWYWxpZCIsImlzSlNPTiIsInBhcnNlIiwiZWxlbSIsImlzVG9vbEVsZW0iLCJBcnJheSIsImZyb20iLCJlbGVtZW50cyIsInRvb2xzIiwiY2hpbGRyZW4iLCJmb3JFYWNoIiwiY2hpbGQiLCJjbGFzc05hbWUiLCJjb2xvck91dHB1dCIsImNvbG9ySW5wdXQiLCJsaW5lV2lkdGhJbnB1dCIsImxpbmVXaWR0aE91dHB1dCIsImRvd25sb2FkIiwic2V0VG9vbCIsImRvd25sb2FkSW1hZ2UiLCJiYWNrZ3JvdW5kQ29sb3IiLCJzaXplIiwidG9TdHJpbmciLCJpbWFnZSIsImhyZWYiLCJnZXRFbGVtZW50c0J5Q2xhc3NOYW1lIiwiUG9pbnRfMSIsImV2ZW50IiwiUG9pbnQiLCJwYWdlWCIsInBhZ2VZIiwiX3giLCJfeSIsIl9saW5lV2lkdGgiLCJfY29sb3IiLCJzIiwiX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiY2FjaGVkTW9kdWxlIiwidW5kZWZpbmVkIiwibW9kdWxlIiwiX193ZWJwYWNrX21vZHVsZXNfXyIsIkRyYXdpbmdfMSIsInNldHVwSW5pdGlhbFByb3BlcnRpZXMiLCJjcmVhdGUiLCJydW4iXSwic291cmNlUm9vdCI6IiJ9