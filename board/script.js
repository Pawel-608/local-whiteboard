(()=>{"use strict";var t={870:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Drawing=void 0;const a=s(212),i=s(71),o=s(646),n=s(44),r=s(909),l=s(718);e.Drawing=class{constructor(){this.startDraw=t=>{n.Control.isControlElem(t.target)||(this.tool=i.ToolFactory.getTool(o.BoardStorage.get("tool"),this.canvas,l.Properties.local),this.tool.startDraw(r.Mouse.getPosition(t)),window.addEventListener("pointermove",this.draw,!1))},this.draw=t=>this.tool.addPoint(r.Mouse.getPosition(t)),this.endDraw=()=>{window.removeEventListener("pointermove",this.draw,!1),this.tool.endDraw()},this.canvas=new a.Canvas,n.Control.setupListeners(),this.appendListeners()}static setup(){this.instance||(this.instance=new this)}appendListeners(){window.addEventListener("pointerdown",this.startDraw,!1),window.addEventListener("pointerup",this.endDraw,!1)}}},212:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Canvas=void 0;const a=s(426);e.Canvas=class{constructor(){this._canvas=document.createElement("canvas"),this._canvas.width=window.screen.availWidth,this._canvas.height=window.screen.availHeight,this._ctx=this._canvas.getContext("2d"),this.setup(),document.body.appendChild(this._canvas)}setup(){this.ctx.lineJoin=a.Config.lineJoin,this.ctx.lineCap=a.Config.lineCap}setColor(t){this._ctx.strokeStyle=t,this._ctx.fillStyle=t}setLineWidth(t){this._ctx.lineWidth=t}clear(){this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height)}get canvas(){return this._canvas}get ctx(){return this._ctx}}},426:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Config=void 0,e.Config={lineJoin:"round",lineCap:"round",canDraw:!1}},466:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MainCanvas=void 0;const a=s(212),i=s(646);class o extends a.Canvas{constructor(){super(),this.drawWhiteBackground(),this.drawFromStorage(),this.sendToBack()}static create(){this.Instance}static get Instance(){return this._instance||(this._instance=new this)}drawWhiteBackground(){let t=this.ctx.fillStyle;this.ctx.fillStyle="white",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle=t}drawFromStorage(){let t=i.BoardStorage.get("img");if(!t)return;let e=new Image;e.src=t,e.addEventListener("load",(()=>this.ctx.drawImage(e,0,0)))}sendToBack(){this.canvas.style.zIndex="-1000"}drawImage(t){this.ctx.drawImage(t,0,0)}saveInStorage(){let t=this.getImgSrc();i.BoardStorage.set("img",t)}getImgSrc(){let t=this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height);return this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.putImageData(t,0,0),this.canvas.toDataURL("image/png")}}e.MainCanvas=o},663:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Brush=void 0;const a=s(397);class i extends a.Tool{prepare(){this.canvas.setColor(this.properties.color),this.canvas.setLineWidth(this.properties.lineWidth)}}e.Brush=i,i._toolName="brush"},327:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Eraser=void 0;const a=s(397);class i extends a.Tool{prepare(){this.canvas.setColor("#ffffff"),this.canvas.setLineWidth(this.properties.lineWidth)}}e.Eraser=i,i._toolName="eraser"},601:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.NullTool=void 0;const a=s(718),i=s(397);class o extends i.Tool{constructor(){super({},a.Properties.local)}static get Instance(){return this._instance||(this._instance=new this)}addPoint(){}startDraw(){}endDraw(){}prepare(){}}e.NullTool=o,o._toolName="none"},397:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Tool=void 0;const a=s(466);e.Tool=class{constructor(t,e){this.canvas=t,this.properties=e,this.points=[]}static get toolName(){return this._toolName}addPoint(t){this.points.push(t),this.draw()}startDraw(t){this.prepare(),this.addPoint(t)}draw(){if(this.points.length<3){let t=this.points[0];return this.canvas.ctx.beginPath(),this.canvas.ctx.arc(t.x,t.y,this.canvas.ctx.lineWidth/2,0,2*Math.PI,!0),this.canvas.ctx.fill(),void this.canvas.ctx.closePath()}this.canvas.ctx.clearRect(0,0,this.canvas.canvas.width,this.canvas.canvas.height),this.canvas.ctx.beginPath(),this.canvas.ctx.moveTo(this.points[0].x,this.points[0].y);for(let t=1;t<this.points.length-2;t++){let e=(this.points[t].x+this.points[t+1].x)/2,s=(this.points[t].y+this.points[t+1].y)/2;this.canvas.ctx.quadraticCurveTo(this.points[t].x,this.points[t].y,e,s)}let t=this.points.length-2;this.canvas.ctx.quadraticCurveTo(this.points[t].x,this.points[t].y,this.points[t+1].x,this.points[t+1].y),this.canvas.ctx.stroke()}endDraw(){a.MainCanvas.Instance.drawImage(this.canvas.canvas),a.MainCanvas.Instance.saveInStorage(),this.canvas.clear()}}},71:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ToolFactory=void 0;const a=s(663),i=s(327),o=s(601);e.ToolFactory=class{static getTool(t,e,s){switch(t){case a.Brush.toolName:return new a.Brush(e,s);case i.Eraser.toolName:return new i.Eraser(e,s);default:return o.NullTool.Instance}}}},646:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BoardStorage=void 0;const a=s(392);e.BoardStorage=class{static set(t,e){"object"!=typeof e&&sessionStorage.setItem(t,e),e=JSON.stringify(e),sessionStorage.setItem(t,e)}static get(t){let e=sessionStorage.getItem(t);return a.Valid.isJSON(e)?JSON.parse(e):e}}},44:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Control=void 0;const a=s(646);class i{static isControlElem(t){let e=!1;return Array.from(this.elements.tools.children).forEach((s=>{s.className!=t.className||(e=!0)})),e||t.className==this.elements.colorOutput.className||t.className==this.elements.colorInput.className||t.className==this.elements.lineWidthInput.className||t.className==this.elements.lineWidthOutput.className||t.className==this.elements.download.className}static setupListeners(){this.elements.lineWidthInput.addEventListener("input",(t=>this.setLineWidth(+t.target.value))),this.elements.colorInput.addEventListener("input",(t=>this.setColor(t.target.value))),this.elements.tools.addEventListener("click",(t=>this.setTool(t.target.className))),this.elements.download.addEventListener("click",(()=>this.downloadImage()))}static setupInitialProperties(){this.setColor(a.BoardStorage.get("color")||"#000000"),this.setLineWidth(a.BoardStorage.get("lineWidth")||10),this.setTool(a.BoardStorage.get("tool")||"brush")}static setColor(t){a.BoardStorage.set("color",t),this.elements.colorOutput.style.backgroundColor=t}static setLineWidth(t){a.BoardStorage.set("lineWidth",t.toString()),this.elements.lineWidthOutput.value=t.toString(),this.elements.lineWidthInput.value=t.toString()}static setTool(t){"tools"!=t&&a.BoardStorage.set("tool",t)}static downloadImage(){let t=a.BoardStorage.get("img");this.elements.download.href=t}}e.Control=i,i.elements={colorOutput:document.getElementsByClassName("color-label-element")[0],colorInput:document.getElementsByClassName("color")[0],lineWidthOutput:document.getElementsByClassName("paint-size-out")[0],lineWidthInput:document.getElementsByClassName("paint-size-in")[0],tools:document.getElementsByClassName("tools")[0],download:document.getElementsByClassName("download")[0]}},909:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Mouse=void 0;const a=s(967);e.Mouse=class{static getPosition(t){return new a.Point(t.pageX,t.pageY)}}},967:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Point=void 0,e.Point=class{constructor(t,e){this._x=t,this._y=e}get x(){return this._x}get y(){return this._y}}},718:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Properties=void 0;const a=s(646);e.Properties=class{constructor(t,e){this._lineWidth=t,this._color=e}static get local(){return new this(+a.BoardStorage.get("lineWidth"),a.BoardStorage.get("color"))}get lineWidth(){return this._lineWidth}get color(){return this._color}}},392:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Valid=void 0,e.Valid=class{static isJSON(t){try{JSON.parse(t)}catch(t){return!1}return!0}}}},e={};function s(a){var i=e[a];if(void 0!==i)return i.exports;var o=e[a]={exports:{}};return t[a](o,o.exports,s),o.exports}(()=>{const t=s(870),e=s(466),a=s(44);(class{static run(){a.Control.setupInitialProperties(),e.MainCanvas.create(),t.Drawing.setup()}}).run()})()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TyxJQUN0REQsRUFBUXNCLGdCQUFhLEVBQ3JCLE1BQU1qQixFQUFpQixFQUFRLEtBZ0IvQkwsRUFBUXNCLFdBZlIsTUFDSWIsWUFBWW1ELEVBQVdKLEdBQ25COUMsS0FBS3NKLFdBQWFwRyxFQUNsQmxELEtBQUt1SixPQUFTekcsRUFFUGpDLG1CQUNQLE9BQU8sSUFBSWIsTUFBTUwsRUFBZWMsYUFBYUMsSUFBSSxhQUFjZixFQUFlYyxhQUFhQyxJQUFJLFVBRS9Gd0MsZ0JBQ0EsT0FBT2xELEtBQUtzSixXQUVaeEcsWUFDQSxPQUFPOUMsS0FBS3VKLFUsWUNmcEJuSyxPQUFPQyxlQUFlQyxFQUFTLGFBQWMsQ0FBRUMsT0FBTyxJQUN0REQsRUFBUStILFdBQVEsRUFZaEIvSCxFQUFRK0gsTUFYUixNQUNJNUYsY0FBYytILEdBQ1YsSUFDSXZDLEtBQUtNLE1BQU1pQyxHQUVmLE1BQU90SixHQUNILE9BQU8sRUFFWCxPQUFPLE1DVlh1SixFQUEyQixHQUcvQixTQUFTQyxFQUFvQkMsR0FFNUIsSUFBSUMsRUFBZUgsRUFBeUJFLEdBQzVDLFFBQXFCRSxJQUFqQkQsRUFDSCxPQUFPQSxFQUFhdEssUUFHckIsSUFBSXdLLEVBQVNMLEVBQXlCRSxHQUFZLENBR2pEckssUUFBUyxJQU9WLE9BSEF5SyxFQUFvQkosR0FBVUcsRUFBUUEsRUFBT3hLLFFBQVNvSyxHQUcvQ0ksRUFBT3hLLFEsTUNuQmYsTUFBTTBLLEVBQVksRUFBUSxLQUNwQjNFLEVBQWUsRUFBUSxLQUN2QnpGLEVBQVksRUFBUSxLQUMxQixNQUNJNkIsYUFDSTdCLEVBQVVPLFFBQVE4Six5QkFDbEI1RSxFQUFhL0IsV0FBVzRHLFNBQ3hCRixFQUFVeEssUUFBUThDLFdBR3JCNkgsTyIsInNvdXJjZXMiOlsid2VicGFjazovL3doaXRlYm9hcmQtdjUvLi9ib2FyZC90cy9EcmF3aW5nLnRzIiwid2VicGFjazovL3doaXRlYm9hcmQtdjUvLi9ib2FyZC90cy9jYW52YXMvQ2FudmFzLnRzIiwid2VicGFjazovL3doaXRlYm9hcmQtdjUvLi9ib2FyZC90cy9jYW52YXMvQ29uZmlnLnRzIiwid2VicGFjazovL3doaXRlYm9hcmQtdjUvLi9ib2FyZC90cy9jYW52YXMvTWFpbkNhbnZhcy50cyIsIndlYnBhY2s6Ly93aGl0ZWJvYXJkLXY1Ly4vYm9hcmQvdHMvdG9vbHMvQnJ1c2gudHMiLCJ3ZWJwYWNrOi8vd2hpdGVib2FyZC12NS8uL2JvYXJkL3RzL3Rvb2xzL0VyYXNlci50cyIsIndlYnBhY2s6Ly93aGl0ZWJvYXJkLXY1Ly4vYm9hcmQvdHMvdG9vbHMvTnVsbFRvb2wudHMiLCJ3ZWJwYWNrOi8vd2hpdGVib2FyZC12NS8uL2JvYXJkL3RzL3Rvb2xzL1Rvb2wudHMiLCJ3ZWJwYWNrOi8vd2hpdGVib2FyZC12NS8uL2JvYXJkL3RzL3Rvb2xzL1Rvb2xGYWN0b3J5LnRzIiwid2VicGFjazovL3doaXRlYm9hcmQtdjUvLi9ib2FyZC90cy91dGlsL0JvYXJkU3RvcmFnZS50cyIsIndlYnBhY2s6Ly93aGl0ZWJvYXJkLXY1Ly4vYm9hcmQvdHMvdXRpbC9Db250cm9sLnRzIiwid2VicGFjazovL3doaXRlYm9hcmQtdjUvLi9ib2FyZC90cy91dGlsL01vdXNlLnRzIiwid2VicGFjazovL3doaXRlYm9hcmQtdjUvLi9ib2FyZC90cy91dGlsL1BvaW50LnRzIiwid2VicGFjazovL3doaXRlYm9hcmQtdjUvLi9ib2FyZC90cy91dGlsL1Byb3BlcnRpZXMudHMiLCJ3ZWJwYWNrOi8vd2hpdGVib2FyZC12NS8uL2JvYXJkL3RzL3V0aWwvVmFsaWQudHMiLCJ3ZWJwYWNrOi8vd2hpdGVib2FyZC12NS93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly93aGl0ZWJvYXJkLXY1Ly4vYm9hcmQvdHMvTWFpbi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG5leHBvcnRzLkRyYXdpbmcgPSB2b2lkIDA7XHJcbmNvbnN0IENhbnZhc18xID0gcmVxdWlyZShcIi4vY2FudmFzL0NhbnZhc1wiKTtcclxuY29uc3QgVG9vbEZhY3RvcnlfMSA9IHJlcXVpcmUoXCIuL3Rvb2xzL1Rvb2xGYWN0b3J5XCIpO1xyXG5jb25zdCBCb2FyZFN0b3JhZ2VfMSA9IHJlcXVpcmUoXCIuL3V0aWwvQm9hcmRTdG9yYWdlXCIpO1xyXG5jb25zdCBDb250cm9sXzEgPSByZXF1aXJlKFwiLi91dGlsL0NvbnRyb2xcIik7XHJcbmNvbnN0IE1vdXNlXzEgPSByZXF1aXJlKFwiLi91dGlsL01vdXNlXCIpO1xyXG5jb25zdCBQcm9wZXJ0aWVzXzEgPSByZXF1aXJlKFwiLi91dGlsL1Byb3BlcnRpZXNcIik7XHJcbmNsYXNzIERyYXdpbmcge1xyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgdGhpcy5zdGFydERyYXcgPSAoZSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoQ29udHJvbF8xLkNvbnRyb2wuaXNDb250cm9sRWxlbShlLnRhcmdldCkpXHJcbiAgICAgICAgICAgICAgICByZXR1cm47IC8vcmV0dXJucyBpZiBlbGVtZW50IGlzIGNvbnRyb2wgZWxlbSAodG9vbCwgY29sb3IgcGlja2VyIGV0Yy4pXHJcbiAgICAgICAgICAgIHRoaXMudG9vbCA9IFRvb2xGYWN0b3J5XzEuVG9vbEZhY3RvcnkuZ2V0VG9vbChCb2FyZFN0b3JhZ2VfMS5Cb2FyZFN0b3JhZ2UuZ2V0KFwidG9vbFwiKSwgdGhpcy5jYW52YXMsIFByb3BlcnRpZXNfMS5Qcm9wZXJ0aWVzLmxvY2FsKTtcclxuICAgICAgICAgICAgdGhpcy50b29sLnN0YXJ0RHJhdyhNb3VzZV8xLk1vdXNlLmdldFBvc2l0aW9uKGUpKTtcclxuICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJwb2ludGVybW92ZVwiLCB0aGlzLmRyYXcsIGZhbHNlKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIHRoaXMuZHJhdyA9IChlKSA9PiB0aGlzLnRvb2wuYWRkUG9pbnQoTW91c2VfMS5Nb3VzZS5nZXRQb3NpdGlvbihlKSk7XHJcbiAgICAgICAgdGhpcy5lbmREcmF3ID0gKCkgPT4ge1xyXG4gICAgICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInBvaW50ZXJtb3ZlXCIsIHRoaXMuZHJhdywgZmFsc2UpO1xyXG4gICAgICAgICAgICB0aGlzLnRvb2wuZW5kRHJhdygpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgdGhpcy5jYW52YXMgPSBuZXcgQ2FudmFzXzEuQ2FudmFzKCk7XHJcbiAgICAgICAgQ29udHJvbF8xLkNvbnRyb2wuc2V0dXBMaXN0ZW5lcnMoKTtcclxuICAgICAgICB0aGlzLmFwcGVuZExpc3RlbmVycygpO1xyXG4gICAgfVxyXG4gICAgc3RhdGljIHNldHVwKCkge1xyXG4gICAgICAgIGlmICghdGhpcy5pbnN0YW5jZSlcclxuICAgICAgICAgICAgdGhpcy5pbnN0YW5jZSA9IG5ldyB0aGlzKCk7XHJcbiAgICB9XHJcbiAgICBhcHBlbmRMaXN0ZW5lcnMoKSB7XHJcbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJwb2ludGVyZG93blwiLCB0aGlzLnN0YXJ0RHJhdywgZmFsc2UpO1xyXG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwicG9pbnRlcnVwXCIsIHRoaXMuZW5kRHJhdywgZmFsc2UpO1xyXG4gICAgfVxyXG59XHJcbmV4cG9ydHMuRHJhd2luZyA9IERyYXdpbmc7XHJcbiIsIlwidXNlIHN0cmljdFwiO1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbmV4cG9ydHMuQ2FudmFzID0gdm9pZCAwO1xyXG5jb25zdCBDb25maWdfMSA9IHJlcXVpcmUoXCIuL0NvbmZpZ1wiKTtcclxuY2xhc3MgQ2FudmFzIHtcclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHRoaXMuX2NhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIik7XHJcbiAgICAgICAgdGhpcy5fY2FudmFzLndpZHRoID0gd2luZG93LnNjcmVlbi5hdmFpbFdpZHRoO1xyXG4gICAgICAgIHRoaXMuX2NhbnZhcy5oZWlnaHQgPSB3aW5kb3cuc2NyZWVuLmF2YWlsSGVpZ2h0O1xyXG4gICAgICAgIHRoaXMuX2N0eCA9IHRoaXMuX2NhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XHJcbiAgICAgICAgdGhpcy5zZXR1cCgpO1xyXG4gICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5fY2FudmFzKTtcclxuICAgIH1cclxuICAgIHNldHVwKCkge1xyXG4gICAgICAgIHRoaXMuY3R4LmxpbmVKb2luID0gQ29uZmlnXzEuQ29uZmlnLmxpbmVKb2luO1xyXG4gICAgICAgIHRoaXMuY3R4LmxpbmVDYXAgPSBDb25maWdfMS5Db25maWcubGluZUNhcDtcclxuICAgIH1cclxuICAgIHNldENvbG9yKGNvbG9yKSB7XHJcbiAgICAgICAgdGhpcy5fY3R4LnN0cm9rZVN0eWxlID0gY29sb3I7XHJcbiAgICAgICAgdGhpcy5fY3R4LmZpbGxTdHlsZSA9IGNvbG9yO1xyXG4gICAgfVxyXG4gICAgc2V0TGluZVdpZHRoKGxpbmVXaWR0aCkge1xyXG4gICAgICAgIHRoaXMuX2N0eC5saW5lV2lkdGggPSBsaW5lV2lkdGg7XHJcbiAgICB9XHJcbiAgICBjbGVhcigpIHtcclxuICAgICAgICB0aGlzLl9jdHguY2xlYXJSZWN0KDAsIDAsIHRoaXMuX2NhbnZhcy53aWR0aCwgdGhpcy5fY2FudmFzLmhlaWdodCk7XHJcbiAgICB9XHJcbiAgICBnZXQgY2FudmFzKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9jYW52YXM7XHJcbiAgICB9XHJcbiAgICBnZXQgY3R4KCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9jdHg7XHJcbiAgICB9XHJcbn1cclxuZXhwb3J0cy5DYW52YXMgPSBDYW52YXM7XHJcbiIsIlwidXNlIHN0cmljdFwiO1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbmV4cG9ydHMuQ29uZmlnID0gdm9pZCAwO1xyXG5jb25zdCBDb25maWcgPSB7XHJcbiAgICBsaW5lSm9pbjogXCJyb3VuZFwiLFxyXG4gICAgbGluZUNhcDogXCJyb3VuZFwiLFxyXG4gICAgY2FuRHJhdzogZmFsc2UsXHJcbn07XHJcbmV4cG9ydHMuQ29uZmlnID0gQ29uZmlnO1xyXG4iLCJcInVzZSBzdHJpY3RcIjtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG5leHBvcnRzLk1haW5DYW52YXMgPSB2b2lkIDA7XHJcbmNvbnN0IENhbnZhc18xID0gcmVxdWlyZShcIi4vQ2FudmFzXCIpO1xyXG5jb25zdCBCb2FyZFN0b3JhZ2VfMSA9IHJlcXVpcmUoXCIuLi91dGlsL0JvYXJkU3RvcmFnZVwiKTtcclxuY2xhc3MgTWFpbkNhbnZhcyBleHRlbmRzIENhbnZhc18xLkNhbnZhcyB7XHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICBzdXBlcigpO1xyXG4gICAgICAgIHRoaXMuZHJhd1doaXRlQmFja2dyb3VuZCgpO1xyXG4gICAgICAgIHRoaXMuZHJhd0Zyb21TdG9yYWdlKCk7XHJcbiAgICAgICAgdGhpcy5zZW5kVG9CYWNrKCk7XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgY3JlYXRlKCkge1xyXG4gICAgICAgIHRoaXMuSW5zdGFuY2U7XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgZ2V0IEluc3RhbmNlKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9pbnN0YW5jZSB8fCAodGhpcy5faW5zdGFuY2UgPSBuZXcgdGhpcygpKTtcclxuICAgIH1cclxuICAgIGRyYXdXaGl0ZUJhY2tncm91bmQoKSB7XHJcbiAgICAgICAgbGV0IHByZXZGaWxsU3R5bGUgPSB0aGlzLmN0eC5maWxsU3R5bGU7XHJcbiAgICAgICAgdGhpcy5jdHguZmlsbFN0eWxlID0gJ3doaXRlJztcclxuICAgICAgICB0aGlzLmN0eC5maWxsUmVjdCgwLCAwLCB0aGlzLmNhbnZhcy53aWR0aCwgdGhpcy5jYW52YXMuaGVpZ2h0KTtcclxuICAgICAgICB0aGlzLmN0eC5maWxsU3R5bGUgPSBwcmV2RmlsbFN0eWxlO1xyXG4gICAgfVxyXG4gICAgZHJhd0Zyb21TdG9yYWdlKCkge1xyXG4gICAgICAgIGxldCBpbWdTcmMgPSBCb2FyZFN0b3JhZ2VfMS5Cb2FyZFN0b3JhZ2UuZ2V0KFwiaW1nXCIpO1xyXG4gICAgICAgIGlmICghaW1nU3JjKVxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgbGV0IGltZyA9IG5ldyBJbWFnZSgpO1xyXG4gICAgICAgIGltZy5zcmMgPSBpbWdTcmM7XHJcbiAgICAgICAgaW1nLmFkZEV2ZW50TGlzdGVuZXIoXCJsb2FkXCIsICgpID0+IHRoaXMuY3R4LmRyYXdJbWFnZShpbWcsIDAsIDApKTtcclxuICAgIH1cclxuICAgIHNlbmRUb0JhY2soKSB7XHJcbiAgICAgICAgdGhpcy5jYW52YXMuc3R5bGUuekluZGV4ID0gXCItMTAwMFwiO1xyXG4gICAgfVxyXG4gICAgZHJhd0ltYWdlKGNhbnZhcykge1xyXG4gICAgICAgIHRoaXMuY3R4LmRyYXdJbWFnZShjYW52YXMsIDAsIDApO1xyXG4gICAgfVxyXG4gICAgc2F2ZUluU3RvcmFnZSgpIHtcclxuICAgICAgICBsZXQgaW1nID0gdGhpcy5nZXRJbWdTcmMoKTtcclxuICAgICAgICBCb2FyZFN0b3JhZ2VfMS5Cb2FyZFN0b3JhZ2Uuc2V0KFwiaW1nXCIsIGltZyk7XHJcbiAgICB9XHJcbiAgICBnZXRJbWdTcmMoKSB7XHJcbiAgICAgICAgbGV0IGltZ2QgPSB0aGlzLmN0eC5nZXRJbWFnZURhdGEoMCwgMCwgdGhpcy5jYW52YXMud2lkdGgsIHRoaXMuY2FudmFzLmhlaWdodCk7XHJcbiAgICAgICAgdGhpcy5jdHguY2xlYXJSZWN0KDAsIDAsIHRoaXMuY2FudmFzLndpZHRoLCB0aGlzLmNhbnZhcy5oZWlnaHQpO1xyXG4gICAgICAgIHRoaXMuY3R4LnB1dEltYWdlRGF0YShpbWdkLCAwLCAwKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5jYW52YXMudG9EYXRhVVJMKFwiaW1hZ2UvcG5nXCIpO1xyXG4gICAgfVxyXG59XHJcbmV4cG9ydHMuTWFpbkNhbnZhcyA9IE1haW5DYW52YXM7XHJcbiIsIlwidXNlIHN0cmljdFwiO1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbmV4cG9ydHMuQnJ1c2ggPSB2b2lkIDA7XHJcbmNvbnN0IFRvb2xfMSA9IHJlcXVpcmUoXCIuL1Rvb2xcIik7XHJcbmNsYXNzIEJydXNoIGV4dGVuZHMgVG9vbF8xLlRvb2wge1xyXG4gICAgcHJlcGFyZSgpIHtcclxuICAgICAgICB0aGlzLmNhbnZhcy5zZXRDb2xvcih0aGlzLnByb3BlcnRpZXMuY29sb3IpO1xyXG4gICAgICAgIHRoaXMuY2FudmFzLnNldExpbmVXaWR0aCh0aGlzLnByb3BlcnRpZXMubGluZVdpZHRoKTtcclxuICAgIH1cclxufVxyXG5leHBvcnRzLkJydXNoID0gQnJ1c2g7XHJcbkJydXNoLl90b29sTmFtZSA9IFwiYnJ1c2hcIjtcclxuIiwiXCJ1c2Ugc3RyaWN0XCI7XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuZXhwb3J0cy5FcmFzZXIgPSB2b2lkIDA7XHJcbmNvbnN0IFRvb2xfMSA9IHJlcXVpcmUoXCIuL1Rvb2xcIik7XHJcbmNsYXNzIEVyYXNlciBleHRlbmRzIFRvb2xfMS5Ub29sIHtcclxuICAgIHByZXBhcmUoKSB7XHJcbiAgICAgICAgdGhpcy5jYW52YXMuc2V0Q29sb3IoXCIjZmZmZmZmXCIpO1xyXG4gICAgICAgIHRoaXMuY2FudmFzLnNldExpbmVXaWR0aCh0aGlzLnByb3BlcnRpZXMubGluZVdpZHRoKTtcclxuICAgIH1cclxufVxyXG5leHBvcnRzLkVyYXNlciA9IEVyYXNlcjtcclxuRXJhc2VyLl90b29sTmFtZSA9IFwiZXJhc2VyXCI7XHJcbiIsIlwidXNlIHN0cmljdFwiO1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbmV4cG9ydHMuTnVsbFRvb2wgPSB2b2lkIDA7XHJcbmNvbnN0IFByb3BlcnRpZXNfMSA9IHJlcXVpcmUoXCIuLi91dGlsL1Byb3BlcnRpZXNcIik7XHJcbmNvbnN0IFRvb2xfMSA9IHJlcXVpcmUoXCIuL1Rvb2xcIik7XHJcbmNsYXNzIE51bGxUb29sIGV4dGVuZHMgVG9vbF8xLlRvb2wge1xyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgc3VwZXIoe30sIFByb3BlcnRpZXNfMS5Qcm9wZXJ0aWVzLmxvY2FsKTtcclxuICAgIH1cclxuICAgIHN0YXRpYyBnZXQgSW5zdGFuY2UoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2luc3RhbmNlIHx8ICh0aGlzLl9pbnN0YW5jZSA9IG5ldyB0aGlzKCkpO1xyXG4gICAgfVxyXG4gICAgLy9vdmVyd3JpdGVcclxuICAgIGFkZFBvaW50KCkgeyB9XHJcbiAgICA7XHJcbiAgICBzdGFydERyYXcoKSB7IH1cclxuICAgIDtcclxuICAgIGVuZERyYXcoKSB7IH1cclxuICAgIDtcclxuICAgIHByZXBhcmUoKSB7IH1cclxuICAgIDtcclxufVxyXG5leHBvcnRzLk51bGxUb29sID0gTnVsbFRvb2w7XHJcbk51bGxUb29sLl90b29sTmFtZSA9IFwibm9uZVwiO1xyXG4iLCJcInVzZSBzdHJpY3RcIjtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG5leHBvcnRzLlRvb2wgPSB2b2lkIDA7XHJcbmNvbnN0IE1haW5DYW52YXNfMSA9IHJlcXVpcmUoXCIuLi9jYW52YXMvTWFpbkNhbnZhc1wiKTtcclxuY2xhc3MgVG9vbCB7XHJcbiAgICBjb25zdHJ1Y3RvcihjYW52YXMsIHByb3BlcnRpZXMpIHtcclxuICAgICAgICB0aGlzLmNhbnZhcyA9IGNhbnZhcztcclxuICAgICAgICB0aGlzLnByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzO1xyXG4gICAgICAgIHRoaXMucG9pbnRzID0gW107XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgZ2V0IHRvb2xOYW1lKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl90b29sTmFtZTtcclxuICAgIH1cclxuICAgIGFkZFBvaW50KHBvaW50KSB7XHJcbiAgICAgICAgdGhpcy5wb2ludHMucHVzaChwb2ludCk7XHJcbiAgICAgICAgdGhpcy5kcmF3KCk7XHJcbiAgICB9XHJcbiAgICBzdGFydERyYXcocG9pbnQpIHtcclxuICAgICAgICB0aGlzLnByZXBhcmUoKTtcclxuICAgICAgICB0aGlzLmFkZFBvaW50KHBvaW50KTtcclxuICAgIH1cclxuICAgIDtcclxuICAgIGRyYXcoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMucG9pbnRzLmxlbmd0aCA8IDMpIHtcclxuICAgICAgICAgICAgbGV0IGIgPSB0aGlzLnBvaW50c1swXTtcclxuICAgICAgICAgICAgdGhpcy5jYW52YXMuY3R4LmJlZ2luUGF0aCgpO1xyXG4gICAgICAgICAgICB0aGlzLmNhbnZhcy5jdHguYXJjKGIueCwgYi55LCB0aGlzLmNhbnZhcy5jdHgubGluZVdpZHRoIC8gMiwgMCwgTWF0aC5QSSAqIDIsICEwKTtcclxuICAgICAgICAgICAgdGhpcy5jYW52YXMuY3R4LmZpbGwoKTtcclxuICAgICAgICAgICAgdGhpcy5jYW52YXMuY3R4LmNsb3NlUGF0aCgpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuY2FudmFzLmN0eC5jbGVhclJlY3QoMCwgMCwgdGhpcy5jYW52YXMuY2FudmFzLndpZHRoLCB0aGlzLmNhbnZhcy5jYW52YXMuaGVpZ2h0KTtcclxuICAgICAgICB0aGlzLmNhbnZhcy5jdHguYmVnaW5QYXRoKCk7XHJcbiAgICAgICAgdGhpcy5jYW52YXMuY3R4Lm1vdmVUbyh0aGlzLnBvaW50c1swXS54LCB0aGlzLnBvaW50c1swXS55KTtcclxuICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHRoaXMucG9pbnRzLmxlbmd0aCAtIDI7IGkrKykgeyAvL1RoaXMgbWFrZSBsaW5lIHNtb290aGVyXHJcbiAgICAgICAgICAgIGxldCBjID0gKHRoaXMucG9pbnRzW2ldLnggKyB0aGlzLnBvaW50c1tpICsgMV0ueCkgLyAyO1xyXG4gICAgICAgICAgICBsZXQgZCA9ICh0aGlzLnBvaW50c1tpXS55ICsgdGhpcy5wb2ludHNbaSArIDFdLnkpIC8gMjtcclxuICAgICAgICAgICAgdGhpcy5jYW52YXMuY3R4LnF1YWRyYXRpY0N1cnZlVG8odGhpcy5wb2ludHNbaV0ueCwgdGhpcy5wb2ludHNbaV0ueSwgYywgZCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCBpID0gdGhpcy5wb2ludHMubGVuZ3RoIC0gMjtcclxuICAgICAgICB0aGlzLmNhbnZhcy5jdHgucXVhZHJhdGljQ3VydmVUbyh0aGlzLnBvaW50c1tpXS54LCB0aGlzLnBvaW50c1tpXS55LCB0aGlzLnBvaW50c1tpICsgMV0ueCwgdGhpcy5wb2ludHNbaSArIDFdLnkpO1xyXG4gICAgICAgIHRoaXMuY2FudmFzLmN0eC5zdHJva2UoKTtcclxuICAgIH1cclxuICAgIDtcclxuICAgIGVuZERyYXcoKSB7XHJcbiAgICAgICAgTWFpbkNhbnZhc18xLk1haW5DYW52YXMuSW5zdGFuY2UuZHJhd0ltYWdlKHRoaXMuY2FudmFzLmNhbnZhcyk7XHJcbiAgICAgICAgTWFpbkNhbnZhc18xLk1haW5DYW52YXMuSW5zdGFuY2Uuc2F2ZUluU3RvcmFnZSgpO1xyXG4gICAgICAgIHRoaXMuY2FudmFzLmNsZWFyKCk7XHJcbiAgICB9XHJcbiAgICA7XHJcbn1cclxuZXhwb3J0cy5Ub29sID0gVG9vbDtcclxuIiwiXCJ1c2Ugc3RyaWN0XCI7XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuZXhwb3J0cy5Ub29sRmFjdG9yeSA9IHZvaWQgMDtcclxuY29uc3QgQnJ1c2hfMSA9IHJlcXVpcmUoXCIuL0JydXNoXCIpO1xyXG5jb25zdCBFcmFzZXJfMSA9IHJlcXVpcmUoXCIuL0VyYXNlclwiKTtcclxuY29uc3QgTnVsbFRvb2xfMSA9IHJlcXVpcmUoXCIuL051bGxUb29sXCIpO1xyXG5jbGFzcyBUb29sRmFjdG9yeSB7XHJcbiAgICBzdGF0aWMgZ2V0VG9vbCh0b29sTmFtZSwgY2FudmFzLCBwcm9wZXJ0aWVzKSB7XHJcbiAgICAgICAgc3dpdGNoICh0b29sTmFtZSkge1xyXG4gICAgICAgICAgICBjYXNlIEJydXNoXzEuQnJ1c2gudG9vbE5hbWU6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEJydXNoXzEuQnJ1c2goY2FudmFzLCBwcm9wZXJ0aWVzKTtcclxuICAgICAgICAgICAgY2FzZSBFcmFzZXJfMS5FcmFzZXIudG9vbE5hbWU6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEVyYXNlcl8xLkVyYXNlcihjYW52YXMsIHByb3BlcnRpZXMpO1xyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIE51bGxUb29sXzEuTnVsbFRvb2wuSW5zdGFuY2U7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbmV4cG9ydHMuVG9vbEZhY3RvcnkgPSBUb29sRmFjdG9yeTtcclxuIiwiXCJ1c2Ugc3RyaWN0XCI7XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuZXhwb3J0cy5Cb2FyZFN0b3JhZ2UgPSB2b2lkIDA7XHJcbmNvbnN0IFZhbGlkXzEgPSByZXF1aXJlKFwiLi9WYWxpZFwiKTtcclxuY2xhc3MgQm9hcmRTdG9yYWdlIHtcclxuICAgIHN0YXRpYyBzZXQoa2V5LCB2YWx1ZSkge1xyXG4gICAgICAgIGlmICh0eXBlb2YgdmFsdWUgIT09IFwib2JqZWN0XCIpXHJcbiAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oa2V5LCB2YWx1ZSk7XHJcbiAgICAgICAgdmFsdWUgPSBKU09OLnN0cmluZ2lmeSh2YWx1ZSk7XHJcbiAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbShrZXksIHZhbHVlKTtcclxuICAgIH1cclxuICAgIHN0YXRpYyBnZXQoa2V5KSB7XHJcbiAgICAgICAgbGV0IGl0ZW0gPSBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKGtleSk7XHJcbiAgICAgICAgaWYgKCFWYWxpZF8xLlZhbGlkLmlzSlNPTihpdGVtKSlcclxuICAgICAgICAgICAgcmV0dXJuIGl0ZW07XHJcbiAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UoaXRlbSk7XHJcbiAgICB9XHJcbn1cclxuZXhwb3J0cy5Cb2FyZFN0b3JhZ2UgPSBCb2FyZFN0b3JhZ2U7XHJcbiIsIlwidXNlIHN0cmljdFwiO1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbmV4cG9ydHMuQ29udHJvbCA9IHZvaWQgMDtcclxuY29uc3QgQm9hcmRTdG9yYWdlXzEgPSByZXF1aXJlKFwiLi9Cb2FyZFN0b3JhZ2VcIik7XHJcbmNsYXNzIENvbnRyb2wge1xyXG4gICAgc3RhdGljIGlzQ29udHJvbEVsZW0oZWxlbSkge1xyXG4gICAgICAgIGxldCBpc1Rvb2xFbGVtID0gZmFsc2U7XHJcbiAgICAgICAgQXJyYXkuZnJvbSh0aGlzLmVsZW1lbnRzLnRvb2xzLmNoaWxkcmVuKS5mb3JFYWNoKGNoaWxkID0+IHtcclxuICAgICAgICAgICAgaWYgKGNoaWxkLmNsYXNzTmFtZSA9PSBlbGVtLmNsYXNzTmFtZSkge1xyXG4gICAgICAgICAgICAgICAgaXNUb29sRWxlbSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gKGlzVG9vbEVsZW0gfHwgZWxlbS5jbGFzc05hbWUgPT0gdGhpcy5lbGVtZW50cy5jb2xvck91dHB1dC5jbGFzc05hbWUgfHwgZWxlbS5jbGFzc05hbWUgPT0gdGhpcy5lbGVtZW50cy5jb2xvcklucHV0LmNsYXNzTmFtZSB8fCBlbGVtLmNsYXNzTmFtZSA9PSB0aGlzLmVsZW1lbnRzLmxpbmVXaWR0aElucHV0LmNsYXNzTmFtZSB8fCBlbGVtLmNsYXNzTmFtZSA9PSB0aGlzLmVsZW1lbnRzLmxpbmVXaWR0aE91dHB1dC5jbGFzc05hbWUgfHwgZWxlbS5jbGFzc05hbWUgPT0gdGhpcy5lbGVtZW50cy5kb3dubG9hZC5jbGFzc05hbWUpO1xyXG4gICAgfVxyXG4gICAgc3RhdGljIHNldHVwTGlzdGVuZXJzKCkge1xyXG4gICAgICAgIHRoaXMuZWxlbWVudHMubGluZVdpZHRoSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsIGUgPT4gdGhpcy5zZXRMaW5lV2lkdGgoK2UudGFyZ2V0LnZhbHVlKSk7XHJcbiAgICAgICAgdGhpcy5lbGVtZW50cy5jb2xvcklucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCBlID0+IHRoaXMuc2V0Q29sb3IoZS50YXJnZXQudmFsdWUpKTtcclxuICAgICAgICB0aGlzLmVsZW1lbnRzLnRvb2xzLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBlID0+IHRoaXMuc2V0VG9vbChlLnRhcmdldC5jbGFzc05hbWUpKTtcclxuICAgICAgICB0aGlzLmVsZW1lbnRzLmRvd25sb2FkLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB0aGlzLmRvd25sb2FkSW1hZ2UoKSk7XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgc2V0dXBJbml0aWFsUHJvcGVydGllcygpIHtcclxuICAgICAgICB0aGlzLnNldENvbG9yKEJvYXJkU3RvcmFnZV8xLkJvYXJkU3RvcmFnZS5nZXQoXCJjb2xvclwiKSB8fCBcIiMwMDAwMDBcIik7XHJcbiAgICAgICAgdGhpcy5zZXRMaW5lV2lkdGgoQm9hcmRTdG9yYWdlXzEuQm9hcmRTdG9yYWdlLmdldChcImxpbmVXaWR0aFwiKSB8fCAxMCk7XHJcbiAgICAgICAgdGhpcy5zZXRUb29sKEJvYXJkU3RvcmFnZV8xLkJvYXJkU3RvcmFnZS5nZXQoXCJ0b29sXCIpIHx8IFwiYnJ1c2hcIik7XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgc2V0Q29sb3IoY29sb3IpIHtcclxuICAgICAgICBCb2FyZFN0b3JhZ2VfMS5Cb2FyZFN0b3JhZ2Uuc2V0KFwiY29sb3JcIiwgY29sb3IpO1xyXG4gICAgICAgIHRoaXMuZWxlbWVudHMuY29sb3JPdXRwdXQuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gY29sb3I7XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgc2V0TGluZVdpZHRoKHNpemUpIHtcclxuICAgICAgICBCb2FyZFN0b3JhZ2VfMS5Cb2FyZFN0b3JhZ2Uuc2V0KFwibGluZVdpZHRoXCIsIHNpemUudG9TdHJpbmcoKSk7XHJcbiAgICAgICAgdGhpcy5lbGVtZW50cy5saW5lV2lkdGhPdXRwdXQudmFsdWUgPSBzaXplLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgdGhpcy5lbGVtZW50cy5saW5lV2lkdGhJbnB1dC52YWx1ZSA9IHNpemUudG9TdHJpbmcoKTtcclxuICAgIH1cclxuICAgIHN0YXRpYyBzZXRUb29sKHRvb2wpIHtcclxuICAgICAgICBpZiAodG9vbCA9PSBcInRvb2xzXCIpXHJcbiAgICAgICAgICAgIHJldHVybjsgLy8gSWYgdXNlciBjbGljayBvbiBuYXYgKCBub3Qgb24gdG9vbCBpY29uICkganVzdCByZXR1cm4uXHJcbiAgICAgICAgQm9hcmRTdG9yYWdlXzEuQm9hcmRTdG9yYWdlLnNldChcInRvb2xcIiwgdG9vbCk7XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgZG93bmxvYWRJbWFnZSgpIHtcclxuICAgICAgICBsZXQgaW1hZ2UgPSBCb2FyZFN0b3JhZ2VfMS5Cb2FyZFN0b3JhZ2UuZ2V0KFwiaW1nXCIpO1xyXG4gICAgICAgIHRoaXMuZWxlbWVudHMuZG93bmxvYWQuaHJlZiA9IGltYWdlO1xyXG4gICAgfVxyXG59XHJcbmV4cG9ydHMuQ29udHJvbCA9IENvbnRyb2w7XHJcbkNvbnRyb2wuZWxlbWVudHMgPSB7XHJcbiAgICBjb2xvck91dHB1dDogZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShcImNvbG9yLWxhYmVsLWVsZW1lbnRcIilbMF0sXHJcbiAgICBjb2xvcklucHV0OiBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwiY29sb3JcIilbMF0sXHJcbiAgICBsaW5lV2lkdGhPdXRwdXQ6IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJwYWludC1zaXplLW91dFwiKVswXSxcclxuICAgIGxpbmVXaWR0aElucHV0OiBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwicGFpbnQtc2l6ZS1pblwiKVswXSxcclxuICAgIHRvb2xzOiBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwidG9vbHNcIilbMF0sXHJcbiAgICBkb3dubG9hZDogZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShcImRvd25sb2FkXCIpWzBdXHJcbn07XHJcbiIsIlwidXNlIHN0cmljdFwiO1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbmV4cG9ydHMuTW91c2UgPSB2b2lkIDA7XHJcbmNvbnN0IFBvaW50XzEgPSByZXF1aXJlKFwiLi9Qb2ludFwiKTtcclxuY2xhc3MgTW91c2Uge1xyXG4gICAgc3RhdGljIGdldFBvc2l0aW9uKGV2ZW50KSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBQb2ludF8xLlBvaW50KGV2ZW50LnBhZ2VYLCBldmVudC5wYWdlWSk7XHJcbiAgICB9XHJcbn1cclxuZXhwb3J0cy5Nb3VzZSA9IE1vdXNlO1xyXG4iLCJcInVzZSBzdHJpY3RcIjtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG5leHBvcnRzLlBvaW50ID0gdm9pZCAwO1xyXG5jbGFzcyBQb2ludCB7XHJcbiAgICBjb25zdHJ1Y3Rvcih4LCB5KSB7XHJcbiAgICAgICAgdGhpcy5feCA9IHg7XHJcbiAgICAgICAgdGhpcy5feSA9IHk7XHJcbiAgICB9XHJcbiAgICBnZXQgeCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5feDtcclxuICAgIH1cclxuICAgIGdldCB5KCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl95O1xyXG4gICAgfVxyXG59XHJcbmV4cG9ydHMuUG9pbnQgPSBQb2ludDtcclxuIiwiXCJ1c2Ugc3RyaWN0XCI7XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuZXhwb3J0cy5Qcm9wZXJ0aWVzID0gdm9pZCAwO1xyXG5jb25zdCBCb2FyZFN0b3JhZ2VfMSA9IHJlcXVpcmUoXCIuL0JvYXJkU3RvcmFnZVwiKTtcclxuY2xhc3MgUHJvcGVydGllcyB7XHJcbiAgICBjb25zdHJ1Y3RvcihsaW5lV2lkdGgsIGNvbG9yKSB7XHJcbiAgICAgICAgdGhpcy5fbGluZVdpZHRoID0gbGluZVdpZHRoO1xyXG4gICAgICAgIHRoaXMuX2NvbG9yID0gY29sb3I7XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgZ2V0IGxvY2FsKCkge1xyXG4gICAgICAgIHJldHVybiBuZXcgdGhpcygrQm9hcmRTdG9yYWdlXzEuQm9hcmRTdG9yYWdlLmdldChcImxpbmVXaWR0aFwiKSwgQm9hcmRTdG9yYWdlXzEuQm9hcmRTdG9yYWdlLmdldChcImNvbG9yXCIpKTtcclxuICAgIH1cclxuICAgIGdldCBsaW5lV2lkdGgoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2xpbmVXaWR0aDtcclxuICAgIH1cclxuICAgIGdldCBjb2xvcigpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fY29sb3I7XHJcbiAgICB9XHJcbn1cclxuZXhwb3J0cy5Qcm9wZXJ0aWVzID0gUHJvcGVydGllcztcclxuIiwiXCJ1c2Ugc3RyaWN0XCI7XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuZXhwb3J0cy5WYWxpZCA9IHZvaWQgMDtcclxuY2xhc3MgVmFsaWQge1xyXG4gICAgc3RhdGljIGlzSlNPTihzKSB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgSlNPTi5wYXJzZShzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxufVxyXG5leHBvcnRzLlZhbGlkID0gVmFsaWQ7XHJcbiIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdHZhciBjYWNoZWRNb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdO1xuXHRpZiAoY2FjaGVkTW9kdWxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRyZXR1cm4gY2FjaGVkTW9kdWxlLmV4cG9ydHM7XG5cdH1cblx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcblx0dmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7XG5cdFx0Ly8gbm8gbW9kdWxlLmlkIG5lZWRlZFxuXHRcdC8vIG5vIG1vZHVsZS5sb2FkZWQgbmVlZGVkXG5cdFx0ZXhwb3J0czoge31cblx0fTtcblxuXHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cblx0X193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0obW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cblx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcblx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xufVxuXG4iLCJcInVzZSBzdHJpY3RcIjtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG5jb25zdCBEcmF3aW5nXzEgPSByZXF1aXJlKFwiLi9EcmF3aW5nXCIpO1xyXG5jb25zdCBNYWluQ2FudmFzXzEgPSByZXF1aXJlKFwiLi9jYW52YXMvTWFpbkNhbnZhc1wiKTtcclxuY29uc3QgQ29udHJvbF8xID0gcmVxdWlyZShcIi4vdXRpbC9Db250cm9sXCIpO1xyXG5jbGFzcyBNYWluIHtcclxuICAgIHN0YXRpYyBydW4oKSB7XHJcbiAgICAgICAgQ29udHJvbF8xLkNvbnRyb2wuc2V0dXBJbml0aWFsUHJvcGVydGllcygpO1xyXG4gICAgICAgIE1haW5DYW52YXNfMS5NYWluQ2FudmFzLmNyZWF0ZSgpO1xyXG4gICAgICAgIERyYXdpbmdfMS5EcmF3aW5nLnNldHVwKCk7XHJcbiAgICB9XHJcbn1cclxuTWFpbi5ydW4oKTtcclxuIl0sIm5hbWVzIjpbIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwiRHJhd2luZyIsIkNhbnZhc18xIiwiVG9vbEZhY3RvcnlfMSIsIkJvYXJkU3RvcmFnZV8xIiwiQ29udHJvbF8xIiwiTW91c2VfMSIsIlByb3BlcnRpZXNfMSIsImNvbnN0cnVjdG9yIiwidGhpcyIsInN0YXJ0RHJhdyIsImUiLCJDb250cm9sIiwiaXNDb250cm9sRWxlbSIsInRhcmdldCIsInRvb2wiLCJUb29sRmFjdG9yeSIsImdldFRvb2wiLCJCb2FyZFN0b3JhZ2UiLCJnZXQiLCJjYW52YXMiLCJQcm9wZXJ0aWVzIiwibG9jYWwiLCJNb3VzZSIsImdldFBvc2l0aW9uIiwid2luZG93IiwiYWRkRXZlbnRMaXN0ZW5lciIsImRyYXciLCJhZGRQb2ludCIsImVuZERyYXciLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiQ2FudmFzIiwic2V0dXBMaXN0ZW5lcnMiLCJhcHBlbmRMaXN0ZW5lcnMiLCJzdGF0aWMiLCJpbnN0YW5jZSIsIkNvbmZpZ18xIiwiX2NhbnZhcyIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsIndpZHRoIiwic2NyZWVuIiwiYXZhaWxXaWR0aCIsImhlaWdodCIsImF2YWlsSGVpZ2h0IiwiX2N0eCIsImdldENvbnRleHQiLCJzZXR1cCIsImJvZHkiLCJhcHBlbmRDaGlsZCIsImN0eCIsImxpbmVKb2luIiwiQ29uZmlnIiwibGluZUNhcCIsInNldENvbG9yIiwiY29sb3IiLCJzdHJva2VTdHlsZSIsImZpbGxTdHlsZSIsInNldExpbmVXaWR0aCIsImxpbmVXaWR0aCIsImNsZWFyIiwiY2xlYXJSZWN0IiwiY2FuRHJhdyIsIk1haW5DYW52YXMiLCJzdXBlciIsImRyYXdXaGl0ZUJhY2tncm91bmQiLCJkcmF3RnJvbVN0b3JhZ2UiLCJzZW5kVG9CYWNrIiwiSW5zdGFuY2UiLCJfaW5zdGFuY2UiLCJwcmV2RmlsbFN0eWxlIiwiZmlsbFJlY3QiLCJpbWdTcmMiLCJpbWciLCJJbWFnZSIsInNyYyIsImRyYXdJbWFnZSIsInN0eWxlIiwiekluZGV4Iiwic2F2ZUluU3RvcmFnZSIsImdldEltZ1NyYyIsInNldCIsImltZ2QiLCJnZXRJbWFnZURhdGEiLCJwdXRJbWFnZURhdGEiLCJ0b0RhdGFVUkwiLCJCcnVzaCIsIlRvb2xfMSIsIlRvb2wiLCJwcmVwYXJlIiwicHJvcGVydGllcyIsIl90b29sTmFtZSIsIkVyYXNlciIsIk51bGxUb29sIiwiTWFpbkNhbnZhc18xIiwicG9pbnRzIiwidG9vbE5hbWUiLCJwb2ludCIsInB1c2giLCJsZW5ndGgiLCJiIiwiYmVnaW5QYXRoIiwiYXJjIiwieCIsInkiLCJNYXRoIiwiUEkiLCJmaWxsIiwiY2xvc2VQYXRoIiwibW92ZVRvIiwiaSIsImMiLCJkIiwicXVhZHJhdGljQ3VydmVUbyIsInN0cm9rZSIsIkJydXNoXzEiLCJFcmFzZXJfMSIsIk51bGxUb29sXzEiLCJWYWxpZF8xIiwia2V5Iiwic2Vzc2lvblN0b3JhZ2UiLCJzZXRJdGVtIiwiSlNPTiIsInN0cmluZ2lmeSIsIml0ZW0iLCJnZXRJdGVtIiwiVmFsaWQiLCJpc0pTT04iLCJwYXJzZSIsImVsZW0iLCJpc1Rvb2xFbGVtIiwiQXJyYXkiLCJmcm9tIiwiZWxlbWVudHMiLCJ0b29scyIsImNoaWxkcmVuIiwiZm9yRWFjaCIsImNoaWxkIiwiY2xhc3NOYW1lIiwiY29sb3JPdXRwdXQiLCJjb2xvcklucHV0IiwibGluZVdpZHRoSW5wdXQiLCJsaW5lV2lkdGhPdXRwdXQiLCJkb3dubG9hZCIsInNldFRvb2wiLCJkb3dubG9hZEltYWdlIiwiYmFja2dyb3VuZENvbG9yIiwic2l6ZSIsInRvU3RyaW5nIiwiaW1hZ2UiLCJocmVmIiwiZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSIsIlBvaW50XzEiLCJldmVudCIsIlBvaW50IiwicGFnZVgiLCJwYWdlWSIsIl94IiwiX3kiLCJfbGluZVdpZHRoIiwiX2NvbG9yIiwicyIsIl9fd2VicGFja19tb2R1bGVfY2FjaGVfXyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImNhY2hlZE1vZHVsZSIsInVuZGVmaW5lZCIsIm1vZHVsZSIsIl9fd2VicGFja19tb2R1bGVzX18iLCJEcmF3aW5nXzEiLCJzZXR1cEluaXRpYWxQcm9wZXJ0aWVzIiwiY3JlYXRlIiwicnVuIl0sInNvdXJjZVJvb3QiOiIifQ==